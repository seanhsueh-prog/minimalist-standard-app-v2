<!-- minimalist-wardrobe-core_v8.2_final.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <!-- [PWA CONFIG 1] Viewport: 確保不隨意縮放，適配全螢幕 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>Style Guardian V8.2</title>
    
    <!-- [PWA CONFIG 2] 連線 Manifest (Android 核心) -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ffffff">

    <!-- [PWA CONFIG 3] iOS Safari 專用設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="StyleGuardian">
    <link rel="apple-touch-icon" href="./icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [V8.0 Style] Hoshiba Minimalist - The "Skin" Upgrade */
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: #f4f4f5; /* Zinc-100 */
            margin: 0;
            height: 100dvh; 
            display: flex;
            justify-content: center; 
            overflow: hidden;
            color: #18181b; /* Zinc-900 */
            /* iOS Safe Area Support */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .app-container {
            width: 100%;
            max-width: 480px; 
            height: 100%; 
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.1); 
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            position: relative;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; width: 100%; height: 100%; display: flex; flex-direction: column; }

        /* --- [LOCKED CORE] GHOST ENGINE & SMART ZOOM --- */
        .ghost-canvas-container {
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; background-color: #fafafa; overflow: hidden;
        }
        .ghost-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain; object-position: bottom center;
            pointer-events: none; transition: opacity 0.3s ease-in-out;
            padding: 11vh 3vw 110px 3vw; /* Padding Locked */
        }
        .layer-shoes { z-index: 10; }
        .layer-bottom { z-index: 20; }
        .layer-inner { z-index: 30; }
        .layer-outer { z-index: 40; }

        /* Smart Zoom Classes (Locked) */
        .img-top-focus { width: 100%; height: 100%; object-fit: contain; transform-origin: top center; transform: scale(1.4); transition: transform 0.2s; }
        .img-bottom-focus { width: 100%; height: 100%; object-fit: contain; transform-origin: bottom center; transform: scale(1.4); transition: transform 0.2s; }
        .img-shoe-focus { width: 100%; height: 100%; object-fit: contain; transform-origin: bottom center; transform: scale(3.2); padding-bottom: 12px; transition: transform 0.2s; }
        /* ----------------------------------------------- */

        /* [V8.0 Style] UI Components - Text Only */
        
        .styling-header {
            position: absolute; top: 0; left: 0; width: 100%; z-index: 50;
            padding: 24px; pointer-events: none;
            padding-top: max(24px, env(safe-area-inset-top)); 
        }
        .header-title {
            font-size: 12px; font-weight: 900; letter-spacing: 0.05em; color: #000;
        }

        .control-stack {
            position: absolute; bottom: 100px;
            display: flex; flex-direction: column; gap: 16px;
            z-index: 50; padding: 0 12px;
        }
        .control-stack.left { left: 0; align-items: flex-start; }
        .control-stack.right { right: 0; align-items: flex-end; }

        .stack-group {
            background: rgba(255, 255, 255, 0.70);
            backdrop-filter: blur(16px);
            border-radius: 4px;
            padding: 4px;
            border: 0.5px solid #e4e4e7;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); 
            display: flex; flex-direction: column; gap: 4px;
            align-items: center; min-width: 42px;
        }

        .text-btn {
            writing-mode: horizontal-tb;
            width: 100%;
            padding: 10px 4px;
            border-radius: 2px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.2em; 
            color: #a1a1aa; 
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .text-btn:hover { color: #52525b; }
        .text-btn.active { color: #000; font-weight: 700; }
        
        .status-dot {
            width: 3px; height: 3px; background-color: #000; border-radius: 50%;
            position: absolute; right: 2px; top: 50%; transform: translateY(-50%);
        }

        .action-btn-black {
            width: 40px; height: auto;
            writing-mode: vertical-rl; text-orientation: upright;
            padding: 16px 8px;
            background: #000; color: #fff;
            font-size: 11px; font-weight: 700; letter-spacing: 0.2em;
            border-radius: 2px;
            cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.1s;
        }
        .action-btn-black:active { transform: scale(0.96); }

        .action-btn-white {
            width: 40px; height: auto;
            writing-mode: vertical-rl; text-orientation: upright;
            padding: 12px 8px;
            background: #fff; color: #52525b;
            border: 0.5px solid #e4e4e7;
            font-size: 11px; font-weight: 600; letter-spacing: 0.2em;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.1s;
        }
        .action-btn-white:active { transform: scale(0.96); background: #f4f4f5; }

        .floating-nav-container {
            position: absolute; bottom: 28px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 100; pointer-events: none;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .floating-nav {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 0.5px solid #e4e4e7;
            padding: 4px 6px;
            border-radius: 99px;
            display: flex; gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .nav-text {
            padding: 8px 16px; border-radius: 99px; 
            font-size: 11px; font-weight: 600; letter-spacing: 0.1em;
            color: #a1a1aa; cursor: pointer; transition: all 0.2s;
        }
        .nav-text.active { color: #000; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .fixed-header-section {
            flex-shrink: 0; background-color: #fff; z-index: 20;
            padding: 24px 24px 12px 24px;
            border-bottom: 0.5px solid #f4f4f5;
            display: flex; flex-direction: column; gap: 12px;
            padding-top: max(24px, env(safe-area-inset-top));
        }
        .section-title { font-size: 14px; font-weight: 700; letter-spacing: 0.05em; color: #18181b; }

        .scrollable-list-section {
            flex: 1; overflow-y: auto; padding: 16px; scrollbar-width: none;
        }
        .scrollable-list-section::-webkit-scrollbar { display: none; }

        .grid-container { display: grid; grid-template-columns: 1fr; gap: 20px; }
        
        .item-card {
            background: #fff; border-radius: 8px; 
            border: 0.5px solid #e4e4e7;
            overflow: hidden; display: flex; flex-direction: column;
            transition: all 0.2s;
        }
        .item-image-box {
            aspect-ratio: 3/4; width: 100%; display: flex; align-items: center; justify-content: center;
            background: #fafafa; position: relative; overflow: hidden; padding: 0;
        }
        .item-info {
            padding: 10px 4px; text-align: center; border-top: 0.5px solid #f4f4f5; background: #fff;
        }
        .item-label { font-size: 11px; font-weight: 600; color: #52525b; letter-spacing: 0.05em; }

        .category-btn {
            padding: 6px 16px; border-radius: 2px; font-size: 11px; font-weight: 600; letter-spacing: 0.05em;
            border: 0.5px solid #e4e4e7; color: #a1a1aa; background: #fff;
            transition: all 0.2s; flex-shrink: 0;
        }
        .category-btn.active { background: #18181b; color: #fff; border-color: #18181b; }

        .color-dot {
            width: 18px; height: 18px; border-radius: 50%; border: 0.5px solid #e4e4e7; cursor: pointer;
        }
        .color-dot.active { box-shadow: 0 0 0 2px #fff, 0 0 0 3px #18181b; }
        .scroll-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; flex-shrink: 0; }
        .scroll-row::-webkit-scrollbar { display: none; }

    </style>
</head>
<body>
    <div id="root" class="w-full flex justify-center h-full"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- MANIFEST (V7.3 Updated) ---
        const RAW_MANIFEST = [
            "o_suits_bk_01.png", "o_suits_br_01.png", "o_suits_gy_01.png", "o_suits_nv_01.png",
            "o_suitd_bk_01.png", "o_suitd_br_01.png", "o_suitd_gy_01.png", "o_suitd_nv_01.png",
            "o_leather_bk_01.png", "o_leather_bk_02.png", "o_leather_bk_03.png", "o_leather_bk_04.png",
            "o_leather_br_01.png", "o_leather_br_02.png", "o_leather_br_03.png",
            "o_jacket_bk_01.png", "o_jacket_bk_03.png", "o_jacket_bk_04.png",
            "o_jacket_br_01.png", "o_jacket_br_02.png", "o_jacket_br_03.png",
            "o_jacket_gn_01.png", "o_jacket_gn_02.png", "o_jacket_gn_03.png",
            "o_jacket_gy_01.png", "o_jacket_gy_02.png", "o_jacket_gy_03.png", "o_jacket_gy_04.png",
            "o_jacket_nv_01.png", "o_jacket_nv_02.png", "o_jacket_nv_03.png",
            "o_down_gy_01.png", "o_down_nv_01.png", "o_down_wh_01.png",
            "i_knits_be_01.png", "i_knits_bk_01.png", "i_knits_br_01.png", "i_knits_gy_01.png", "i_knits_rd_01.png",
            "i_knitn_be_01.png", "i_knitn_bk_01.png", "i_knitn_br_01.png", "i_knitn_gy_01.png", "i_knitn_rd_01.png",
            "i_shirts_bk_01.png", "i_shirts_nv_01.png", "i_shirts_wh_01.png",
            "i_shirtn_bk_01.png", "i_shirtn_nv_01.png", "i_shirtn_wh_01.png",
            "i_sweats_bk_01.png", "i_sweats_gn_01.png", "i_sweats_gy_01.png", "i_sweats_nv_01.png", "i_sweats_wh_01.png",
            "i_tshirts_bk_01.png", "i_tshirts_gy_01.png", "i_tshirts_wh_01.png",
            "i_tshirtn_bk_01.png", "i_tshirtn_gy_01.png", "i_tshirtn_nv_01.png", "i_tshirtn_wh_01.png",
            "b_cargo_be_01.png", "b_cargo_bk_01.png", "b_cargo_gn_01.png",
            "b_chino_be_01.png",
            "b_jeans_bk_01.png", "b_jeans_nv_01.png",
            "b_sport_bk_01.png", "b_sport_gy_01.png", "b_sport_nv_01.png", "b_sport_wh_01.png",
            "b_suit_be_02.png", "b_suit_bk_01.png", "b_suit_bk_02.png", "b_suit_br_01.png", "b_suit_br_02.png",
            "b_suit_gn_01.png", "b_suit_gn_02.png", "b_suit_gy_01.png", "b_suit_gy_02.png", "b_suit_nv_01.png",
            "s_dress_bk_01.png", "s_dress_br_01.png",
            "s_leasnk_bk_01.png", "s_leasnk_wh_01.png",
            "s_loafer_bk_01.png", "s_loafer_br_01.png", "s_loafer_nv_01.png",
            "s_sport_bk_01.png", "s_sport_gy_01.png", "s_sport_wh_01.png"
        ];

        // --- DB CONFIG (LOCKED) ---
        const DB_CONFIG = { name: 'Minimalist_Master_Vault', version: 1, store: 'inventory' };
        
        const PART_MAP = { o: '外套', i: '內搭', b: '褲裝', s: '鞋款' };
        const INNER_ORDER = ['shirts', 'tshirts', 'polos', 'knits', 'sweats'];
        const BOTTOM_ORDER = ['suit', 'jeans', 'chino', 'shorts', 'sport', 'cargo'];

        const TYPE_MAP = {
            suits: '單排西裝', suitd: '雙排西裝', leather: '皮衣', jacket: '夾克', down: '羽絨',
            knits: '有袖針織', knitn: '無袖針織', 
            shirts: '有袖襯衫', shirtn: '無袖襯衫', 
            sweats: '衛衣',
            tshirts: '有袖T', tshirtn: '無袖T', 
            cargo: '工裝褲', chino: '卡其褲', jeans: '牛仔褲',
            sport: '運動褲', suit: '西裝褲', 
            dress: '皮鞋', leasnk: '休閒皮鞋', loafer: '樂福鞋', sport_s: '運動鞋'
        };

        const COLOR_MAP = {
            bk: { name: '黑', hex: '#111' }, wh: { name: '白', hex: '#fff' }, gy: { name: '灰', hex: '#888' },
            nv: { name: '深藍', hex: '#1e3a8a' }, br: { name: '棕', hex: '#78350f' }, gn: { name: '綠', hex: '#166534' },
            be: { name: '大地', hex: '#d4b483' }, dm: { name: '丹寧', hex: '#4f83cc' }, rd: { name: '酒紅', hex: '#7f1d1d' }
        };

        const STYLE_LOGIC = {
            'suits': ['Formal', 'Smart'], 'suitd': ['Formal', 'Smart'], 
            'leather': ['Smart', 'Casual'], 'jacket': ['Smart', 'Casual'], 'down': ['Casual'],
            'shirts': ['Formal', 'Smart'], 'shirtn': ['Formal', 'Smart'], 
            'knits': ['Smart', 'Casual'], 'knitn': ['Smart', 'Casual'],
            'sweats': ['Casual'],
            'tshirts': ['Casual', 'Smart'], 'tshirtn': ['Casual', 'Smart'],
            'suit': ['Formal', 'Smart'], 
            'chino': ['Smart', 'Casual'], 'jeans': ['Smart', 'Casual'],
            'cargo': ['Casual'], 'sport': ['Casual'],
            'dress': ['Formal', 'Smart'], 'loafer': ['Formal', 'Smart'], 
            'leasnk': ['Smart', 'Casual'], 'sport_s': ['Casual']
        };

        const parseFileName = (fn) => {
            const p = fn.replace('.png', '').split('_');
            const type = (p[1] === 'sport' && p[0] === 's') ? 'sport_s' : p[1];
            return {
                fileName: fn, part: p[0], type: type, color: p[2], suffixId: p[3],
                displayName: `${TYPE_MAP[type] || type} / ${COLOR_MAP[p[2]]?.name || p[2]}`,
                style: STYLE_LOGIC[type] || ['Casual']
            };
        };

        const dbHelper = {
            open: () => new Promise((res) => {
                const req = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version);
                req.onupgradeneeded = (e) => e.target.result.createObjectStore(DB_CONFIG.store, { keyPath: 'id', autoIncrement: true });
                req.onsuccess = () => res(req.result);
            }),
            save: async (item) => {
                const db = await dbHelper.open();
                const tx = db.transaction(DB_CONFIG.store, 'readwrite');
                const cleanItem = { ...item }; delete cleanItem.id;
                tx.objectStore(DB_CONFIG.store).add(cleanItem);
            },
            getAll: async () => {
                const db = await dbHelper.open();
                return new Promise((res) => {
                    db.transaction(DB_CONFIG.store, 'readonly').objectStore(DB_CONFIG.store).getAll().onsuccess = (e) => res(e.target.result);
                });
            },
            delete: async (id) => {
                const db = await dbHelper.open();
                db.transaction(DB_CONFIG.store, 'readwrite').objectStore(DB_CONFIG.store).delete(id);
            }
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('styling');
            const [wardrobe, setWardrobe] = useState([]);
            const [outfit, setOutfit] = useState({ o: null, i: null, b: null, s: null });
            const [occasion, setOccasion] = useState('Smart');
            const [season, setSeason] = useState('Winter');
            const [whPart, setWhPart] = useState('o');
            const [whType, setWhType] = useState('suits');
            const [whColor, setWhColor] = useState('bk');
            const [clPart, setClPart] = useState('o');
            const [clTypeFilter, setClTypeFilter] = useState('all');

            useEffect(() => { loadWardrobe(); }, []);

            const loadWardrobe = async () => { 
                const rawItems = await dbHelper.getAll();
                const patchedItems = rawItems.map(item => ({
                    ...item,
                    style: STYLE_LOGIC[item.type] || ['Casual'] 
                }));
                setWardrobe(patchedItems); 
            };

            const addToWardrobe = async (item) => { await dbHelper.save(item); await loadWardrobe(); alert('單品已入庫'); };
            const removeFromWardrobe = async (id) => {
                if(!confirm("確定從衣櫥移除？")) return;
                await dbHelper.delete(id); await loadWardrobe();
                setOutfit(prev => { const next = {...prev}; Object.keys(next).forEach(k => { if(next[k]?.id === id) next[k] = null; }); return next; });
            };

            const togglePart = (p) => {
                if (outfit[p]) setOutfit(prev => ({...prev, [p]: null}));
                else alert('請使用「智慧搭配」或「衣櫥」來選擇單品');
            };

            // [LOCKED LOGIC] V7.4 Partial Locking & Smart Fallback
            const handleRandom = useCallback(() => {
                let newOutfit = { ...outfit };
                const parts = ['o', 'i', 'b', 's'];
                
                parts.forEach(p => {
                    // Summer Logic (Force Remove Outer)
                    if (p === 'o' && season === 'Summer' && occasion !== 'Formal') {
                        newOutfit.o = null;
                        return;
                    }

                    // Locking Logic (Skip if exists)
                    if (newOutfit[p]) return;
                    
                    // Filling Logic
                    let candidates = wardrobe.filter(item => item.part === p);
                    candidates = candidates.filter(item => item.style.includes(occasion));

                    if (p === 'i') {
                        const hasOuter = !!newOutfit.o;
                        candidates = candidates.filter(item => {
                            const isSleeveless = item.type.endsWith('n'); 
                            const isSleeved = item.type.endsWith('s') || item.type === 'sweats'; 
                            return hasOuter ? isSleeveless : isSleeved;
                        });
                        if (season === 'Summer') candidates = candidates.filter(item => !['knits', 'knitn', 'sweats'].includes(item.type));
                    }

                    if (p === 'b' && occasion === 'Formal' && newOutfit.o && (newOutfit.o.type === 'suits' || newOutfit.o.type === 'suitd')) {
                        const matchedSuit = candidates.filter(item => item.type === 'suit' && item.color === newOutfit.o.color);
                        if (matchedSuit.length > 0) candidates = matchedSuit;
                    }

                    if (p === 's' && occasion === 'Smart' && newOutfit.b?.type === 'suit') {
                        candidates = candidates.filter(item => item.type !== 'sport_s');
                    }

                    if (candidates.length > 0) {
                        newOutfit[p] = candidates[Math.floor(Math.random() * candidates.length)];
                    } else {
                         newOutfit[p] = null;
                    }
                });
                setOutfit(newOutfit);
            }, [wardrobe, occasion, season, outfit]);

            const getSortedTypes = (part) => {
                 const all = RAW_MANIFEST.map(parseFileName).filter(i => i.part === part);
                 const types = [...new Set(all.map(i => i.type))];
                 if (part === 'i') return types.sort((a, b) => INNER_ORDER.indexOf(a.replace(/[ns]$/, '')) - INNER_ORDER.indexOf(b.replace(/[ns]$/, '')));
                 if (part === 'b') return types.sort((a, b) => BOTTOM_ORDER.indexOf(a) - BOTTOM_ORDER.indexOf(b));
                 return types;
            };

            const availableTypes = useMemo(() => getSortedTypes(whPart), [whPart]);
            const availableColors = useMemo(() => {
                const all = RAW_MANIFEST.map(parseFileName).filter(i => i.part === whPart && i.type === whType);
                return [...new Set(all.map(i => i.color))];
            }, [whPart, whType]);
            const filteredWhItems = useMemo(() => RAW_MANIFEST.map(parseFileName).filter(item => item.part === whPart && item.type === whType && item.color === whColor), [whPart, whType, whColor]);

            const handlePartSwitch = (p) => {
                setWhPart(p);
                const sortedTypes = getSortedTypes(p);
                setWhType(sortedTypes[0]);
                const all = RAW_MANIFEST.map(parseFileName).filter(i => i.part === p);
                setWhColor(all.find(i => i.type === sortedTypes[0]).color);
            };

            const handleClPartSwitch = (p) => { setClPart(p); setClTypeFilter('all'); };
            const closetAvailableTypes = useMemo(() => getSortedTypes(clPart), [clPart]);
            const filteredClosetItems = useMemo(() => wardrobe.filter(item => {
                    if (item.part !== clPart) return false;
                    if (clTypeFilter !== 'all' && item.type !== clTypeFilter) return false;
                    return true;
                }), [wardrobe, clPart, clTypeFilter]);

            // [LOCKED CSS] Smart Zoom
            const getImageClass = (part) => {
                if (part === 'o' || part === 'i') return 'img-top-focus';
                if (part === 'b') return 'img-bottom-focus';
                if (part === 's') return 'img-shoe-focus'; 
                return '';
            };

            return (
                <div className="app-container">
                    <div className={`content-area ${activeTab === 'styling' ? 'styling-mode' : ''}`}>
                        {activeTab === 'styling' && (
                            <div className="animate-fade-in relative flex-1">
                                <div className="styling-header">
                                    <h1 className="header-title">STYLE GUARDIAN V8.2</h1>
                                </div>

                                <div className="ghost-canvas-container">
                                    {outfit.s && <img src={`./${outfit.s.fileName}`} className="ghost-layer layer-shoes" />}
                                    {outfit.b && <img src={`./${outfit.b.fileName}`} className="ghost-layer layer-bottom" />}
                                    {outfit.i && <img src={`./${outfit.i.fileName}`} className="ghost-layer layer-inner" />}
                                    {outfit.o && <img src={`./${outfit.o.fileName}`} className="ghost-layer layer-outer" />}
                                </div>
                                
                                {/* LEFT STACK */}
                                <div className="control-stack left">
                                    <div className="stack-group">
                                        {['Summer', 'Winter'].map(s => (
                                            <button key={s} className={`text-btn ${season === s ? 'active' : ''}`} onClick={() => setSeason(s)}>
                                                {s === 'Summer' ? '春夏' : '秋冬'}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="stack-group">
                                        {['Formal', 'Smart', 'Casual'].map(occ => (
                                            <button key={occ} className={`text-btn ${occasion === occ ? 'active' : ''}`} onClick={() => setOccasion(occ)}>
                                                {occ === 'Formal' ? '正式' : occ === 'Smart' ? '大人' : '休閒'}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* RIGHT STACK */}
                                <div className="control-stack right">
                                    <div className="stack-group" style={{gap: '8px', paddingBottom: '8px'}}>
                                        <button onClick={() => setOutfit({o:null,i:null,b:null,s:null})} className="action-btn-white" title="重置">重置</button>
                                        <button onClick={handleRandom} className="action-btn-black" title="智慧搭配">智慧</button>
                                    </div>
                                    <div className="stack-group">
                                        {[
                                            { p: 'o', label: '外套' },
                                            { p: 'i', label: '內搭' },
                                            { p: 'b', label: '褲裝' },
                                            { p: 's', label: '鞋款' }
                                        ].map(item => (
                                            <button key={item.p} className={`text-btn ${outfit[item.p] ? 'active' : ''}`} onClick={() => togglePart(item.p)}>
                                                {item.label}
                                                {outfit[item.p] && <div className="status-dot"></div>}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'closet' && (
                            <div className="animate-fade-in flex flex-col h-full bg-white">
                                <div className="fixed-header-section">
                                    <h2 className="section-title">我的衣櫥</h2>
                                    <div className="scroll-row">
                                        {['o','i','b','s'].map(p => (
                                            <button key={p} onClick={() => handleClPartSwitch(p)} className={`category-btn ${clPart === p ? 'active' : ''}`}>{PART_MAP[p]}</button>
                                        ))}
                                    </div>
                                    <div className="scroll-row">
                                        <button onClick={() => setClTypeFilter('all')} className={`category-btn ${clTypeFilter === 'all' ? 'active' : ''}`}>全部</button>
                                        {closetAvailableTypes.map(t => (
                                            <button key={t} onClick={() => setClTypeFilter(t)} className={`category-btn ${clTypeFilter === t ? 'active' : ''}`}>{TYPE_MAP[t] || t}</button>
                                        ))}
                                    </div>
                                </div>
                                <div className="scrollable-list-section">
                                    <div className="grid-container">
                                        {filteredClosetItems.length > 0 ? filteredClosetItems.map(item => (
                                            <div key={item.id} className="item-card relative cursor-pointer" onClick={() => { setOutfit(prev => ({...prev, [item.part]: item})); setActiveTab('styling'); }}>
                                                <div className="item-image-box">
                                                    <img src={`./${item.fileName}`} className={getImageClass(item.part)} />
                                                </div>
                                                <div className="item-info"><div className="item-label">{item.displayName}</div></div>
                                                <button onClick={(e) => { e.stopPropagation(); removeFromWardrobe(item.id); }} className="absolute top-1 right-1 px-2 py-1 bg-white/90 rounded text-[10px] text-zinc-400 font-bold hover:text-red-500 hover:bg-red-50">移除</button>
                                            </div>
                                        )) : <div className="col-span-2 text-center py-12 text-zinc-300 text-xs tracking-widest">此分類暫無單品</div>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <div className="animate-fade-in flex flex-col h-full bg-white">
                                <div className="fixed-header-section">
                                    <h2 className="section-title">單品倉庫</h2>
                                    <div className="scroll-row">
                                        {['o','i','b','s'].map(p => (
                                            <button key={p} onClick={() => handlePartSwitch(p)} className={`category-btn ${whPart === p ? 'active' : ''}`}>{PART_MAP[p]}</button>
                                        ))}
                                    </div>
                                    {whPart === 'i' && (
                                        <div className="mb-2 bg-zinc-50 p-3 rounded border border-zinc-100">
                                            <p className="text-[10px] text-zinc-500 leading-relaxed tracking-wide">
                                                <span className="font-bold block mb-1 text-zinc-800">搭配邏輯</span>
                                                請同時入庫 <span className="font-bold">無袖 (i系列)</span> 與 <span className="font-bold">有袖 (t系列)</span>，系統將自動依據外套切換。
                                            </p>
                                        </div>
                                    )}
                                    <div className="scroll-row">
                                        {availableTypes.map(t => (
                                            <button key={t} onClick={() => setWhType(t)} className={`category-btn ${whType === t ? 'active' : ''}`}>{TYPE_MAP[t] || t}</button>
                                        ))}
                                    </div>
                                    <div className="flex gap-4 py-2 border-b border-zinc-50 overflow-x-auto no-scrollbar items-center">
                                        {availableColors.map(c => (
                                            <div key={c} onClick={() => setWhColor(c)} className={`color-dot flex-shrink-0 ${whColor === c ? 'active' : ''} ${c === 'wh' ? 'white-swatch' : ''}`} style={{ background: COLOR_MAP[c]?.hex || '#ccc' }}></div>
                                        ))}
                                        <span className="text-[10px] font-bold text-zinc-400 ml-auto flex-shrink-0 uppercase tracking-wider">{COLOR_MAP[whColor]?.name}</span>
                                    </div>
                                </div>
                                <div className="scrollable-list-section">
                                    <div className="grid-container">
                                        {filteredWhItems.map((item, idx) => (
                                            <div key={idx} className="item-card cursor-pointer group" onClick={() => addToWardrobe(item)}>
                                                <div className="item-image-box">
                                                    <img src={`./${item.fileName}`} className={getImageClass(item.part)} />
                                                    <div className="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all">
                                                        <span className="bg-black text-white text-[10px] px-3 py-1 rounded font-bold shadow-sm tracking-widest">入庫</span>
                                                    </div>
                                                </div>
                                                <div className="item-info"><div className="item-label">{item.displayName}</div></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Bottom Nav (Text Only) */}
                    <div className="floating-nav-container">
                        <div className="floating-nav">
                            <div onClick={() => setActiveTab('styling')} className={`nav-text ${activeTab === 'styling' ? 'active' : ''}`}>搭配</div>
                            <div onClick={() => setActiveTab('closet')} className={`nav-text ${activeTab === 'closet' ? 'active' : ''}`}>衣櫥</div>
                            <div onClick={() => setActiveTab('add')} className={`nav-text ${activeTab === 'add' ? 'active' : ''}`}>倉庫</div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>