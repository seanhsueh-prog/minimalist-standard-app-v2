<!-- minimalist-wardrobe-core_v28_3.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minimalist V28.3 - V26 UI + V28 Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [V26.5 ORIGINAL STYLES - RESTORED] */
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: #111; 
            color: #111; 
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center; 
            align-items: flex-start;
        }
        
        .app-container {
            width: 100%;
            max-width: 480px; 
            height: 100vh; 
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 60px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 80px; 
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .content-area::-webkit-scrollbar { display: none; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .ghost-canvas-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 5; 
            background-color: #f9fafb;
            overflow: hidden;
            border-bottom: 1px solid #f0f0f0;
        }

        .ghost-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
            object-position: bottom center;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            will-change: transform, opacity; 
        }

        /* Floating Control Stack */
        .floating-controls {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-40%); 
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 30;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 99px; 
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .mini-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: #9ca3af;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            margin-bottom: 2px;
        }
        .mini-btn:last-child { margin-bottom: 0; }
        
        .mini-btn.active {
            background-color: #000;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Dense Card */
        .dense-card {
            aspect-ratio: 1/1;
            position: relative;
            background: #fff;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s;
            padding: 0; 
        }
        .dense-card:active { transform: scale(0.98); }
        .dense-card img { width: 100%; height: 100%; object-fit: contain; padding: 2px; }

        /* Warehouse Items */
        .warehouse-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            padding-bottom: 2rem;
        }
        .warehouse-item {
            aspect-ratio: 3/4;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 0; 
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: #fff;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .warehouse-item:active { transform: scale(0.98); border-color: #000; }
        .warehouse-item img { width: 100%; height: 100%; object-fit: contain; padding: 8px; }

        /* Category Pills */
        .cat-pill {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
        }
        .cat-pill.active {
            background-color: #000;
            color: #fff;
            border-color: #000;
        }
        .cat-pill.inactive {
            background-color: #fff;
            color: #666;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            padding: 12px 0 24px 0; 
            z-index: 50;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: 600;
            color: #9ca3af;
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
        }
        .nav-item.active {
            color: #000;
        }
        .nav-item svg {
            transition: transform 0.2s;
        }
        .nav-item:active svg {
            transform: scale(0.9);
        }

        /* [V28 EXTRA] Error Fallback Style (Grey Box) */
        .img-fallback {
            width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: #f3f4f6; color: #9ca3af; padding: 4px; text-align: center;
        }
        .img-fallback span.label { font-size: 10px; font-weight: bold; color: #000; }
        .img-fallback span.file { font-size: 8px; margin-top: 2px; word-break: break-all; }
    </style>
</head>
<body>
    <div id="root" class="w-full flex justify-center"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // =================================================================
        // ‚ö†Ô∏è 1. V28 Ë®≠ÂÆöÂçÄÂüü (Ë´ãÂú®Ê≠§Ë≤º‰∏äÊÇ®ÁöÑË≥áÊñô) ‚ö†Ô∏è
        // =================================================================
        
        // [GITHUB PATH] ‰øÆÊ≠£ÂæåÁöÑÊ®ôÊ∫ñË∑ØÂæë (ÁÑ° refs/heads)
        const GITHUB_RAW_URL = "https://raw.githubusercontent.com/oaoxd/my-wardrobe/main/images";

        // [FILE MANIFEST] Ë´ãË≤º‰∏äÊÇ®ÁöÑÊ™îÊ°àÊ∏ÖÂñÆ
        const RAW_MANIFEST = [
            // "o_suit_bk_01.png", 
            // "i_shirts_wh_01.png",
        ];

        // =================================================================
        // --- 2. V28 PARSER ENGINE (Ê†∏ÂøÉÈÇèËºØ) ---
        // =================================================================

        const UI_LABELS = {
            o: 'Â§ñÂ•ó', i: 'ÂÖßÊê≠', b: '‰∏ãË∫´', s: 'ÈûãÊ¨æ',
            suits: 'Ë•øË£ù(ÂñÆ)', suitd: 'Ë•øË£ù(Èõô)', coat: 'Â§ßË°£', leather: 'ÁöÆË°£', jacket: 'Â§æÂÖã',
            shirt: 'Ë•ØË°´', tshirt: 'TÊÅ§', polo: 'Polo', knit: 'ÈáùÁπî',
            jeans: 'Áâõ‰ªî', chino: 'Âç°ÂÖ∂', shorts: 'Áü≠Ë§≤', sport: 'ÈÅãÂãï',
            dress: 'ÁöÆÈûã', loafer: 'Ê®ÇÁ¶è', sneaker: 'ÁêÉÈûã', boots: 'Èù¥Â≠ê',
            bk: 'Èªë', wh: 'ÁôΩ', gy: 'ÁÅ∞', nv: 'Ê∑±Ëóç', be: 'Á±≥', br: 'Ê£ï', dn: '‰∏πÂØß'
        };

        const COLOR_HEX = {
            bk: '#1a1a1a', wh: '#f3f4f6', gy: '#6b7280', nv: '#1e3a8a',
            be: '#d2b48c', br: '#5d4037', dn: '#3b82f6', gn: '#355e3b'
        };

        const parseFilename = (rawName) => {
            const cleanName = rawName.trim().replace(/\.png$/i, '');
            const parts = cleanName.split('_'); // [slot, cat, color, id]

            if (parts.length < 4) return null;

            const [slotCode, catRaw, colorCode] = parts;
            let finalCat = catRaw;
            let sleeveType = 'standard';

            // ÂÖßÊê≠ÂéªÂ≠óÂ∞æÈÇèËºØ
            if (slotCode === 'i') {
                const suffix = catRaw.slice(-1);
                if (suffix === 'n') {
                    sleeveType = 'sleeveless';
                    finalCat = catRaw.slice(0, -1);
                } else if (suffix === 's') {
                    sleeveType = 'sleeved';
                    finalCat = catRaw.slice(0, -1);
                }
            }

            return {
                uuid: cleanName,
                filename: rawName.trim(),
                url: `${GITHUB_RAW_URL}/${rawName.trim()}`,
                displayUrl: `${GITHUB_RAW_URL}/${rawName.trim()}`, // V26Áõ∏ÂÆπÂ≠óÊÆµ
                slot: slotCode,
                category: finalCat,
                color: colorCode,
                sleeve: sleeveType,
                isShoe: slotCode === 's',
                label: UI_LABELS[finalCat] || finalCat,
                labelColor: UI_LABELS[colorCode] || colorCode
            };
        };

        const SYSTEM_STOCK = RAW_MANIFEST.map(parseFilename).filter(Boolean);

        // --- 3. DATABASE (V28 Logic) ---
        const DB_KEY = 'MinimalistVault_V28_3';
        const dbAPI = {
            open: () => new Promise(r => {
                const req = indexedDB.open(DB_KEY, 1);
                req.onupgradeneeded = e => e.target.result.createObjectStore('items', { keyPath: 'uuid' });
                req.onsuccess = e => r(e.target.result);
            }),
            getAll: async () => {
                const db = await dbAPI.open();
                return new Promise(r => {
                    const tx = db.transaction('items', 'readonly');
                    const req = tx.objectStore('items').getAll();
                    req.onsuccess = () => r(req.result);
                });
            },
            add: async (item) => {
                const db = await dbAPI.open();
                const tx = db.transaction('items', 'readwrite');
                tx.objectStore('items').put(item);
                return new Promise(r => tx.oncomplete = r);
            },
            del: async (id) => {
                const db = await dbAPI.open();
                const tx = db.transaction('items', 'readwrite');
                tx.objectStore('items').delete(id);
                return new Promise(r => tx.oncomplete = r);
            }
        };

        // --- 4. CONSTANTS (V26.5 Compatible) ---
        const SLOTS = [
            { id: 'o', label: 'Â§ñÂ•ó' }, { id: 'i', label: 'ÂÖßÊê≠' }, 
            { id: 'b', label: '‰∏ãË∫´' }, { id: 's', label: 'ÈûãÊ¨æ' }
        ];
        const SEASONS = [ { id: 'Winter', label: 'ÂÜ¨Â≠£' }, { id: 'Summer', label: 'Â§èÂ≠£' } ];
        const OCCASIONS = [ { id: 'Formal', label: 'Ê≠£Âºè' }, { id: 'Smart', label: 'Â§ß‰∫∫' }, { id: 'Casual', label: '‰ºëÈñí' } ];
        
        const INVENTORY_TABS = [
            { id: 'o', label: 'Â§ñÂ•ó' }, { id: 'i', label: 'ÂÖßÊê≠' },
            { id: 'b', label: '‰∏ãË∫´' }, { id: 's', label: 'ÈûãÊ¨æ' }
        ];

        // --- 5. COMPONENTS ---

        const Icon = ({ name, className }) => {
            const icons = {
                hanger: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a5 5 0 0 1 4.9 6H7.1a5 5 0 0 1 4.9-6Z"/><path d="M21 21H3V11c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10Z"/></svg>,
                grid: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
                trash: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
                dice: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/><circle cx="16" cy="16" r="1.5" fill="currentColor"/><circle cx="8" cy="16" r="1.5" fill="currentColor"/><circle cx="16" cy="8" r="1.5" fill="currentColor"/></svg>,
                x: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
                plus: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14"/></svg>
            };
            return icons[name] ? React.cloneElement(icons[name], { className }) : null;
        };

        const SafeImage = ({ item, className, style }) => {
            const [error, setError] = useState(false);
            if (error || !item) {
                return (
                    <div className={`${className} img-fallback`} style={style}>
                        <span className="label">{item?.label || 'Item'}</span>
                        <span className="file">{item?.filename}</span>
                    </div>
                );
            }
            return (
                <img 
                    src={item.url} 
                    alt={item.label}
                    className={className}
                    style={style}
                    onError={() => setError(true)}
                />
            );
        };

        const GhostEngine = ({ outfit, occasion, setOccasion, season, setSeason, triggerRandom, onGoToWarehouse }) => {
            const { o, i, b, s } = outfit;
            return (
                <div className="w-full mb-0 flex justify-center items-center animate-fade-in bg-white relative">
                    <div className="ghost-canvas-container mx-auto relative">
                        {s && <SafeImage item={s} className="ghost-layer z-10" style={{ transform: 'translateZ(0)' }} />}
                        {b && <SafeImage item={b} className="ghost-layer z-20" />}
                        {i && <SafeImage item={i} className="ghost-layer z-30" />}
                        {o && <SafeImage item={o} className="ghost-layer z-40" />}
                        
                        {(!s && !b && !i && !o) && (
                            <div className="absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-auto">
                                <p className="text-gray-300 text-xs tracking-widest mb-4">ÊÇ®ÁöÑË°£Ê´•ÁõÆÂâçÊòØÁ©∫ÁöÑ</p>
                                <button onClick={onGoToWarehouse} className="px-4 py-2 bg-black text-white text-xs font-bold rounded-full shadow-lg hover:scale-105 transition-transform">
                                    üí° ÂâçÂæÄÂñÆÂìÅÂÄâÂ∫´Êñ∞Â¢ûÂñÆÂìÅ
                                </button>
                            </div>
                        )}
                    </div>

                    <div className="floating-controls">
                        <div className="control-group mb-3">
                            {SEASONS.map(sea => (
                                <button key={sea.id} className={`mini-btn ${season === sea.id ? 'active' : ''}`} onClick={() => { setSeason(sea.id); }} title={sea.label}>{sea.label.slice(0, 1)}</button>
                            ))}
                        </div>
                        <div className="control-group">
                            {OCCASIONS.map(occ => (
                                <button key={occ.id} className={`mini-btn ${occasion === occ.id ? 'active' : ''}`} onClick={() => { setOccasion(occ.id); }} title={occ.label}>{occ.label.slice(0, 2)}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 6. MAIN APP ---
        const App = () => {
            const [wardrobe, setWardrobe] = useState([]);
            const [outfit, setOutfit] = useState({ o: null, i: null, b: null, s: null });
            const [activeTab, setActiveTab] = useState('styling');
            
            const [occasion, setOccasion] = useState('Smart');
            const [season, setSeason] = useState('Winter');
            const [inventoryTab, setInventoryTab] = useState('o');

            // Warehouse States (Dynamic V28)
            const [whSlot, setWhSlot] = useState('o');
            const [whCat, setWhCat] = useState('all');
            const [whColor, setWhColor] = useState('all');

            useEffect(() => { loadData(); }, []);

            const loadData = async () => {
                const items = await dbAPI.getAll();
                setWardrobe(items);
            };

            const toggleItem = async (sysItem) => {
                const exists = wardrobe.find(x => x.uuid === sysItem.uuid);
                if (exists) {
                    if(!confirm(`ÁßªÈô§ ${sysItem.label}Ôºü`)) return;
                    await dbAPI.del(sysItem.uuid);
                } else {
                    await dbAPI.add(sysItem);
                }
                loadData();
            };

            const handleClearSlot = (slot) => setOutfit(prev => ({ ...prev, [slot]: null }));
            const handleClearAll = () => setOutfit({ o: null, i: null, b: null, s: null });

            const handleRandom = () => {
                const getR = (s) => {
                    const pool = wardrobe.filter(x => x.slot === s);
                    return pool.length ? pool[Math.floor(Math.random() * pool.length)] : null;
                };
                setOutfit({ o: getR('o'), i: getR('i'), b: getR('b'), s: getR('s') });
            };

            // Dynamic Warehouse Filters
            const filteredStock = useMemo(() => {
                return SYSTEM_STOCK.filter(x => {
                    if (x.slot !== whSlot) return false;
                    if (whCat !== 'all' && x.category !== whCat) return false;
                    if (whColor !== 'all' && x.color !== whColor) return false;
                    return true;
                });
            }, [whSlot, whCat, whColor]);

            const availCats = useMemo(() => [...new Set(SYSTEM_STOCK.filter(x => x.slot === whSlot).map(x => x.category))], [whSlot]);
            const availColors = useMemo(() => {
                let pool = SYSTEM_STOCK.filter(x => x.slot === whSlot);
                if(whCat !== 'all') pool = pool.filter(x => x.category === whCat);
                return [...new Set(pool.map(x => x.color))];
            }, [whSlot, whCat]);

            return (
                <div className="app-container">
                    <div className="px-6 pt-6 pb-2 bg-white border-b border-gray-100 flex justify-between items-center z-10 sticky top-0">
                        <h1 className="text-lg font-bold tracking-tighter flex items-center gap-2">Minimalist <span className="bg-black text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm">V28.3</span></h1>
                    </div>

                    <div className="content-area bg-gray-50">
                        {/* TAB 1: STYLING */}
                        {activeTab === 'styling' && (
                            <div className="animate-fade-in">
                                <GhostEngine 
                                    outfit={outfit} occasion={occasion} setOccasion={setOccasion} season={season} setSeason={setSeason}
                                    triggerRandom={handleRandom} onGoToWarehouse={() => setActiveTab('add')} 
                                />
                                <div className="px-6 mt-4 mb-4">
                                    <div className="grid grid-cols-4 gap-2 mb-4">
                                        {['o','i','b','s'].map(slot => (
                                            <div key={slot} className="relative group">
                                                <div className={`aspect-square rounded-xl border flex flex-col items-center justify-center cursor-pointer transition-all overflow-hidden relative ${outfit[slot] ? 'bg-white border-black' : 'bg-gray-100 border-dashed border-gray-300'}`}>
                                                    {outfit[slot] ? (
                                                        <div className={`w-full h-full overflow-hidden ${slot === 's' ? '' : 'p-2 flex items-center justify-center'}`}>
                                                            <SafeImage 
                                                                item={outfit[slot]}
                                                                className="w-full h-full"
                                                                style={slot === 's' || (outfit[slot]?.isShoe)
                                                                    ? { width: '100%', height: '100%', objectFit: 'contain', transform: 'scale(3.8) translateZ(0)', transformOrigin: 'bottom center' } 
                                                                    : { objectFit: 'contain' }
                                                                }
                                                            />
                                                        </div>
                                                    ) : (
                                                        <>
                                                            <span className="text-[9px] font-bold uppercase text-gray-400 mb-1">{SLOTS.find(s=>s.id===slot)?.label}</span>
                                                            <span className="text-xs text-gray-300 font-bold">+</span>
                                                        </>
                                                    )}
                                                </div>
                                                {outfit[slot] && <button onClick={() => handleClearSlot(slot)} className="absolute -top-2 -right-2 bg-white border border-gray-200 text-gray-400 rounded-full p-1 shadow hover:text-red-500 z-20"><Icon name="x" className="w-3 h-3" /></button>}
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={handleClearAll} className="flex-1 py-3 bg-white border border-gray-200 text-gray-500 text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-50 flex items-center justify-center gap-2 active:scale-95 transition-transform"><Icon name="trash" className="w-4 h-4" /> ÈáçÁΩÆ</button>
                                        <button onClick={handleRandom} className="flex-[2] py-3 bg-black text-white text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-900 shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95"><Icon name="dice" className="w-4 h-4" /> Êô∫ÊÖßÊê≠ÈÖç</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 2: CLOSET */}
                        {activeTab === 'closet' && (
                            <div className="p-6 animate-fade-in min-h-full bg-white">
                                <h2 className="text-xl font-bold mb-4">ÊàëÁöÑË°£Ê´• ({wardrobe.length})</h2>
                                <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                                    {INVENTORY_TABS.map(tab => (
                                        <button key={tab.id} onClick={() => setInventoryTab(tab.id)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors ${inventoryTab === tab.id ? 'bg-black text-white' : 'bg-gray-100 text-gray-400'}`}>{tab.label}</button>
                                    ))}
                                </div>
                                <div className="grid grid-cols-3 gap-2">
                                    {wardrobe.filter(item => item.slot === inventoryTab).map(item => (
                                        <div key={item.uuid} onClick={() => { setOutfit(prev => ({...prev, [item.slot]: item})); setActiveTab('styling'); }} className="dense-card cursor-pointer overflow-hidden relative group">
                                            <SafeImage 
                                                item={item}
                                                style={item.slot === 's' 
                                                    ? { width: '100%', height: '100%', objectFit: 'contain', transform: 'scale(3.5)', transformOrigin: 'bottom center', padding: 0 } 
                                                    : {}}
                                            />
                                            <button onClick={(e) => { e.stopPropagation(); toggleItem(item); }} className="absolute top-1 right-1 p-1 bg-white/80 rounded-full text-gray-300 hover:text-red-500"><Icon name="trash" className="w-3 h-3" /></button>
                                        </div>
                                    ))}
                                </div>
                                {wardrobe.length === 0 && <div className="text-center py-12 text-gray-300 text-xs">Ë°£Ê´•Á©∫Á©∫Â¶Ç‰πü</div>}
                            </div>
                        )}

                        {/* TAB 3: WAREHOUSE (V28 Dynamic Filter Style) */}
                        {activeTab === 'add' && (
                            <div className="p-6 animate-fade-in bg-white min-h-full">
                                <h2 className="text-xl font-bold mb-4">ÂñÆÂìÅÂÄâÂ∫´</h2>
                                
                                {/* 1. Slot Filter */}
                                <div className="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                                    {SLOTS.map(s => (
                                        <button key={s.id} onClick={() => { setWhSlot(s.id); setWhCat('all'); setWhColor('all'); }} className={`px-4 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border transition-colors ${whSlot === s.id ? 'bg-black text-white border-black' : 'bg-white text-gray-500 border-gray-200'}`}>{s.label}</button>
                                    ))}
                                </div>

                                {/* 2. Category Filter (Dynamic) */}
                                <div className="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                                    <button onClick={() => setWhCat('all')} className={`cat-pill ${whCat === 'all' ? 'active' : 'inactive'}`}>ÂÖ®ÈÉ®</button>
                                    {availCats.map(c => (
                                        <button key={c} onClick={() => setWhCat(c)} className={`cat-pill ${whCat === c ? 'active' : 'inactive'}`}>{UI_LABELS[c] || c}</button>
                                    ))}
                                </div>

                                {/* 3. Color Filter (Dynamic) */}
                                <div className="flex gap-3 overflow-x-auto no-scrollbar mb-6 py-1">
                                    <div className="flex flex-col items-center gap-1 cursor-pointer flex-shrink-0" onClick={() => setWhColor('all')}>
                                         <span className={`text-xs font-bold ${whColor === 'all' ? 'text-black' : 'text-gray-400'}`}>All</span>
                                    </div>
                                    {availColors.map(c => (
                                        <div key={c} className="flex flex-col items-center gap-1 cursor-pointer flex-shrink-0" onClick={() => setWhColor(c)}>
                                            <div className={`w-6 h-6 rounded-full transition-all shadow-sm ${whColor === c ? 'ring-2 ring-offset-2 ring-black scale-110' : 'hover:scale-105'}`} style={{ background: COLOR_HEX[c] || '#ccc' }}></div>
                                        </div>
                                    ))}
                                </div>

                                {/* 4. Grid */}
                                <div className="warehouse-grid">
                                    {filteredStock.map((item) => {
                                        const inCloset = wardrobe.some(x => x.uuid === item.uuid);
                                        return (
                                            <div key={item.uuid} onClick={() => toggleItem(item)} className={`warehouse-item relative group ${inCloset ? 'border-black' : ''}`}>
                                                <SafeImage 
                                                    item={item}
                                                    style={whSlot === 's' 
                                                        ? { width: '100%', height: '100%', objectFit: 'contain', transform: 'scale(3.5)', transformOrigin: 'bottom center', padding: 0 } 
                                                        : {}}
                                                />
                                                <div className={`absolute inset-0 flex items-center justify-center bg-black/5 transition-opacity ${inCloset ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}`}>
                                                    <span className={`text-white text-[10px] px-2 py-1 rounded-full font-bold ${inCloset ? 'bg-black' : 'bg-gray-400'}`}>
                                                        {inCloset ? 'Â∑≤ÂÖ•Â∫´' : 'ÂÖ•Â∫´'}
                                                    </span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {filteredStock.length === 0 && <div className="col-span-2 text-center text-xs text-gray-400 py-8">ÁÑ°Á¨¶ÂêàÊ¢ù‰ª∂ÂñÆÂìÅ</div>}
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="bottom-nav">
                        <div onClick={() => setActiveTab('styling')} className={`nav-item ${activeTab === 'styling' ? 'active' : ''}`}><Icon name="hanger" className="w-6 h-6" /><span>Êê≠ÈÖç</span></div>
                        <div onClick={() => setActiveTab('closet')} className={`nav-item ${activeTab === 'closet' ? 'active' : ''}`}><Icon name="grid" className="w-6 h-6" /><span>Ë°£Ê´•</span></div>
                        <div onClick={() => setActiveTab('add')} className={`nav-item ${activeTab === 'add' ? 'active' : ''}`}><Icon name="plus" className="w-6 h-6" /><span>ÂÄâÂ∫´</span></div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>