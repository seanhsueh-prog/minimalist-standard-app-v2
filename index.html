<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minimalist V25.2 - Enhanced UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [V25.2 - Mother File Visuals] */
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: #222; 
            color: #111; 
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center; 
            align-items: flex-start;
        }
        
        .app-container {
            width: 100%;
            max-width: 480px; 
            min-height: 100vh;
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 60px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .ghost-canvas-container {
            position: relative;
            width: 100%;
            aspect-ratio: 9 / 16;
            background-color: #f9fafb;
            overflow: hidden;
            border-bottom: 1px solid #f0f0f0;
        }

        .ghost-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
            object-position: bottom center;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }

        /* Segment Control */
        .segment-control {
            background-color: #f3f4f6;
            border-radius: 0.75rem;
            padding: 0.25rem;
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 1.5rem;
        }
        .segment-btn {
            flex: 1;
            text-align: center;
            padding: 0.5rem 0;
            font-size: 0.8rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            color: #9ca3af;
        }
        .segment-btn.active {
            background-color: #ffffff;
            color: #000000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* Dense Card */
        .dense-card {
            aspect-ratio: 1/1;
            position: relative;
            background: #fff;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s;
            padding: 0; 
        }
        .dense-card:active { transform: scale(0.98); }
        .dense-card img { width: 100%; height: 100%; object-fit: contain; padding: 2px; }

        /* Master Style Buttons */
        .master-btn {
            @apply flex-1 py-3 text-[10px] font-bold tracking-wider uppercase rounded-xl border border-gray-100 transition-all active:scale-95 flex flex-col items-center justify-center gap-1 bg-white text-gray-600;
        }
        .master-btn:hover { @apply bg-gray-50 border-gray-300 text-black; }
        /* No active state needed as they are triggers */
    </style>
</head>
<body>
    <div id="root" class="w-full flex justify-center"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. CORE UTILS: IndexedDB (LOCKED) ---
        const DB_CONFIG = {
            name: 'MinimalistVault_V22', 
            version: 1,
            store: 'inventory'
        };

        const dbHelper = {
            open: () => {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version);
                    request.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains(DB_CONFIG.store)) {
                            db.createObjectStore(DB_CONFIG.store, { keyPath: 'id', autoIncrement: true });
                        }
                    };
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            addItem: async (item) => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readwrite');
                    const store = tx.objectStore(DB_CONFIG.store);
                    const request = store.add(item);
                    request.onsuccess = () => resolve({ ...item, id: request.result });
                    request.onerror = () => reject(request.error);
                });
            },
            getAllItems: async () => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readonly');
                    const store = tx.objectStore(DB_CONFIG.store);
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            deleteItem: async (id) => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readwrite');
                    const store = tx.objectStore(DB_CONFIG.store);
                    const request = store.delete(id);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
        };

        // --- 2. LOGIC MAPPING & CONSTANTS ---

        const ITEM_TYPES = {
            coat: ['大衣', '風衣'], 
            outer: ['西裝外套', '皮衣', '大衣', '夾克', '羽絨/背心'],
            inner: ['襯衫', 'T-shirt', 'Polo衫', '毛衣/針織', '帽T/衛衣'],
            bottom: ['西裝褲', '牛仔褲', '卡其褲', '短褲'],
            shoes: ['皮鞋', '樂福鞋', '球鞋', '靴子']
        };

        // V25.2: Extended Palette
        const ALL_COLORS = [
            { id: 'black', hex: '#1A1A1A', name: '黑' },
            { id: 'white', hex: '#FFFFFF', name: '白', border: true },
            { id: 'charcoal', hex: '#374151', name: '深灰' },
            { id: 'lightgray', hex: '#D1D5DB', name: '淺灰', border: true },
            { id: 'navy', hex: '#1E3A8A', name: '海軍藍' },
            { id: 'beige', hex: '#F3E5AB', name: '米色' },
            { id: 'coffee', hex: '#4B3621', name: '咖啡' },
            { id: 'brown', hex: '#8B4513', name: '棕色' },
            { id: 'olive', hex: '#3f4f3a', name: '橄欖綠' },
            { id: 'denim', hex: '#3B82F6', name: '丹寧' }
        ];

        // V25.2: Master Style Definitions
        const MASTER_STYLES = {
            MINIMAL: ['black', 'white', 'charcoal', 'lightgray', 'navy'],
            EARTH: ['beige', 'coffee', 'brown', 'olive'],
            ITALIAN: { outer: ['navy'], bottom: ['beige', 'coffee', 'brown', 'white'] } 
        };

        const SLOTS = [
            { id: 'coat', label: '大衣' },
            { id: 'outer', label: '外套' },
            { id: 'inner', label: '內搭' },
            { id: 'bottom', label: '下身' },
            { id: 'shoes', label: '鞋款' }
        ];

        const OCCASIONS = [
            { id: 'Formal', label: '正式' },
            { id: 'Smart Casual', label: '大人感' },
            { id: 'Casual', label: '休閒' }
        ];

        const SEASONS = [
            { id: 'Winter', label: '❄ 冬季' },
            { id: 'Summer', label: '☀ 夏季' }
        ];

        const INVENTORY_TABS = [
            { id: 'outer', label: '外套', slots: ['outer', 'coat'] },
            { id: 'inner', label: '內搭', slots: ['inner'] },
            { id: 'bottom', label: '下身', slots: ['bottom'] },
            { id: 'shoes', label: '鞋款', slots: ['shoes'] }
        ];

        const DEFAULT_OUTFIT = { coat: null, outer: null, inner: null, bottom: null, shoes: null };

        // --- 3. ICONS ---
        const Icon = ({ name, className }) => {
            const icons = {
                plus: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14"/></svg>,
                trash: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
                check: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
                camera: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>,
                x: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
                dice: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/><circle cx="16" cy="16" r="1.5" fill="currentColor"/><circle cx="8" cy="16" r="1.5" fill="currentColor"/><circle cx="16" cy="8" r="1.5" fill="currentColor"/></svg>
            };
            return icons[name] ? React.cloneElement(icons[name], { className }) : null;
        };

        // --- 4. COMPONENTS ---

        // A. Add Item Modal (V25.2 Updated Colors)
        const AddItemModal = ({ isOpen, onClose, onAdd }) => {
            const [data, setData] = useState({ 
                slot: 'outer', 
                itemType: ITEM_TYPES['outer'][0], 
                color: 'black', 
                image: null,
                rawFile: null 
            });
            const [isProcessing, setIsProcessing] = useState(false);
            const fileInputRef = useRef(null);
            
            const handleSlotChange = (newSlot) => {
                const defaultType = ITEM_TYPES[newSlot] ? ITEM_TYPES[newSlot][0] : '';
                setData(prev => ({ ...prev, slot: newSlot, itemType: defaultType }));
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const preview = URL.createObjectURL(file);
                    setData(prev => ({ ...prev, image: preview, rawFile: file }));
                }
            };

            const handleSave = async (shouldEquip) => {
                if (!data.rawFile) {
                    alert("請先上傳圖片！");
                    return;
                }

                setIsProcessing(true);
                try {
                    // Default to Smart Casual for logic safety
                    const determinedStyles = ['Smart Casual'];

                    const newItem = {
                        slot: data.slot,
                        category: data.itemType, 
                        color: data.color,
                        style: determinedStyles, 
                        image: data.rawFile, 
                        createdAt: Date.now()
                    };

                    await onAdd(newItem, shouldEquip);
                    onClose();
                } catch (e) {
                    alert("存檔失敗: " + e.message);
                } finally {
                    setIsProcessing(false);
                }
            };

            if(!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                    <div className="bg-white w-full max-w-sm rounded-2xl p-6 animate-fade-in shadow-2xl max-h-[90vh] overflow-y-auto relative pb-20">
                        {isProcessing && (
                            <div className="absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center">
                                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-black mb-2"></div>
                                <span className="text-xs font-bold text-gray-500">入庫中...</span>
                            </div>
                        )}

                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold tracking-tight">新增單品</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-black">✕</button>
                        </div>

                        <div className="space-y-6">
                            {/* Category */}
                            <div>
                                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-widest block mb-2">部位</label>
                                <div className="flex gap-2 overflow-x-auto no-scrollbar mb-2 pb-1">
                                    {SLOTS.map(s => (
                                        <button key={s.id} onClick={() => handleSlotChange(s.id)} className={`px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border transition-colors ${data.slot === s.id ? 'bg-black text-white border-black' : 'bg-white text-gray-500 border-gray-200'}`}>{s.label}</button>
                                    ))}
                                </div>
                            </div>

                            {/* Sub-Category */}
                            <div>
                                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-widest block mb-2">種類</label>
                                <select id="item-type" className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm font-medium outline-none focus:border-black" value={data.itemType} onChange={e => setData({...data, itemType: e.target.value})}>
                                    {ITEM_TYPES[data.slot]?.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>

                            {/* V25.2: Extended Colors */}
                            <div>
                                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-widest block mb-2">顏色</label>
                                <div className="flex gap-3 overflow-x-auto no-scrollbar py-2">
                                    {ALL_COLORS.map(c => (
                                        <div key={c.id} className="flex flex-col items-center gap-1 cursor-pointer flex-shrink-0" onClick={() => setData({...data, color: c.id})}>
                                            <div 
                                                className={`w-8 h-8 rounded-full transition-all shadow-sm ${data.color === c.id ? 'ring-2 ring-offset-2 ring-black scale-110' : 'hover:scale-105'}`} 
                                                style={{ background: c.hex, border: c.border ? '1px solid #e5e7eb' : 'none' }}
                                            ></div>
                                            <span className="text-[9px] text-gray-400">{c.name}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Image Upload */}
                            <div 
                                onClick={() => fileInputRef.current.click()}
                                className={`w-full h-32 border-2 border-dashed rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all overflow-hidden relative group ${data.image ? 'border-black bg-white' : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'}`}
                            >
                                {data.image ? (
                                    <>
                                        <img src={data.image} className="w-full h-full object-contain" alt="Preview" />
                                        <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                            <span className="text-white text-xs font-bold">更換圖片</span>
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center text-gray-400">
                                        <Icon name="camera" className="w-6 h-6 mx-auto mb-1 text-gray-400" />
                                        <span className="text-xs font-bold block">點擊上傳</span>
                                    </div>
                                )}
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} accept="image/*" className="hidden" />
                            </div>
                        </div>

                        <div className="mt-8 flex gap-3">
                            <button onClick={() => handleSave(false)} className="flex-1 py-4 bg-gray-100 text-gray-600 text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-200">加入衣櫥</button>
                            <button onClick={() => handleSave(true)} className="flex-[2] py-4 bg-black text-white text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-900 shadow-lg">穿上並預覽</button>
                        </div>
                    </div>
                </div>
            );
        };

        // B. Ghost Engine
        const GhostEngine = ({ outfit }) => {
            const { coat, outer, inner, bottom, shoes } = outfit;
            return (
                <div className="w-full mb-4 flex flex-col items-center animate-fade-in bg-white">
                    <div className="ghost-canvas-container relative">
                        {/* Z-Index Locked: Shoes < Bottom < Inner < Outer */}
                        {shoes && <img src={shoes.displayUrl} className="ghost-layer z-10" alt="Shoes" />}
                        {bottom && <img src={bottom.displayUrl} className="ghost-layer z-20" alt="Bottom" />}
                        {inner && <img src={inner.displayUrl} className="ghost-layer z-30" alt="Inner" />}
                        {(coat || outer) && <img src={coat?.displayUrl || outer?.displayUrl} className="ghost-layer z-40" alt="Outer" />}
                        
                        {(!shoes && !bottom && !inner && !outer && !coat) && (
                            <div className="absolute inset-0 flex items-center justify-center text-gray-300 text-xs tracking-widest">
                                V25.2 Enhanced UI
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // C. Filter Controls
        const FilterControls = ({ occasion, setOccasion, season, setSeason }) => {
            return (
                <div className="flex flex-col gap-2 mb-2">
                    <div className="segment-control">
                        {OCCASIONS.map(occ => (
                            <button
                                key={occ.id}
                                className={`segment-btn ${occasion === occ.id ? 'active' : ''}`}
                                onClick={() => setOccasion(occ.id)}
                            >
                                {occ.label}
                            </button>
                        ))}
                    </div>
                    <div className="segment-control mt-0">
                        {SEASONS.map(s => (
                            <button
                                key={s.id}
                                className={`segment-btn ${season === s.id ? 'active' : ''}`}
                                onClick={() => setSeason(s.id)}
                            >
                                {s.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 5. MAIN APPLICATION ---
        const App = () => {
            const [wardrobe, setWardrobe] = useState([]);
            const [outfit, setOutfit] = useState(DEFAULT_OUTFIT);
            const [inventoryTab, setInventoryTab] = useState('outer'); 
            const [showAddModal, setShowAddModal] = useState(false);
            const [occasion, setOccasion] = useState('Smart Casual'); 
            const [season, setSeason] = useState('Winter'); 

            const loadData = async () => {
                try {
                    const items = await dbHelper.getAllItems();
                    const displayItems = items.map(item => {
                        let url = null;
                        if (item.image instanceof Blob || item.image instanceof File) {
                            url = URL.createObjectURL(item.image);
                        } else if (typeof item.image === 'string') {
                            url = item.image; 
                        }
                        
                        let styles = item.style;
                        if (!styles || (Array.isArray(styles) && styles.length === 0)) {
                            styles = ['Smart Casual'];
                        }

                        return { ...item, displayUrl: url, style: styles };
                    });
                    setWardrobe(displayItems);
                } catch (e) {
                    console.error("DB Load Failed:", e);
                }
            };

            useEffect(() => {
                loadData();
            }, []);

            const handleAddItem = async (newItem, shouldEquip) => {
                try {
                    await dbHelper.addItem(newItem);
                    await loadData();
                    if (shouldEquip) {
                        const displayUrl = URL.createObjectURL(newItem.image);
                        const displayItem = { ...newItem, displayUrl };
                        setOutfit(prev => ({ ...prev, [newItem.slot]: displayItem }));
                    }
                } catch (e) {
                    alert("儲存失敗");
                }
            };

            const handleDeleteItem = async (id) => {
                if(!confirm("確定從資料庫永久刪除？")) return;
                try {
                    await dbHelper.deleteItem(id);
                    await loadData();
                    setOutfit(prev => {
                        const next = { ...prev };
                        Object.keys(next).forEach(k => {
                            if (next[k]?.id === id) next[k] = null;
                        });
                        return next;
                    });
                } catch (e) {
                    alert("刪除失敗");
                }
            };

            // V25.2: Master Style Randomizer (Color Logic)
            const handleMasterRandom = (masterStyle) => {
                const newOutfit = { ...outfit };
                const slots = ['outer', 'inner', 'bottom', 'shoes'];
                let forceOuterOff = false;

                // V24.0 Summer Logic
                if (season === 'Summer') {
                    if (occasion === 'Formal') {
                         // Allow
                    } else {
                         newOutfit.outer = null;
                         newOutfit.coat = null;
                         forceOuterOff = true;
                    }
                }

                slots.forEach(slot => {
                    if (newOutfit[slot]) {
                         if (slot === 'outer' && forceOuterOff) {
                             // Force clear
                         } else {
                             return; // Keep existing
                         }
                    }

                    if (forceOuterOff && slot === 'outer') return;

                    let candidates = wardrobe.filter(item => 
                        item.slot === slot || (slot === 'outer' && item.slot === 'coat')
                    );

                    // 1. Master Style Filter (Color Logic)
                    if (masterStyle === 'MINIMAL') {
                        candidates = candidates.filter(item => MASTER_STYLES.MINIMAL.includes(item.color));
                    } else if (masterStyle === 'EARTH') {
                        candidates = candidates.filter(item => MASTER_STYLES.EARTH.includes(item.color));
                    } else if (masterStyle === 'ITALIAN') {
                        if (slot === 'outer') candidates = candidates.filter(item => MASTER_STYLES.ITALIAN.outer.includes(item.color));
                        else candidates = candidates.filter(item => MASTER_STYLES.ITALIAN.bottom.includes(item.color));
                    }

                    // 2. Sleeve Logic & Winter Layering (V24.2 Locked)
                    if (slot === 'inner') {
                        const hasOuter = newOutfit.outer || newOutfit.coat;
                        if (hasOuter) {
                             // Has Outer -> Prefer Sleeveless (i) logic
                             // For logic simplicity, we filter out known sleeved items if possible, or prioritize sleeveless
                             // V24.2: Force Sleeveless if Outer
                             // Since we don't have explicit 'sleeve' field anymore, we rely on category name
                             // Assuming '背心' or manual tag. Or just let it be mixed if data not tagged.
                             // To be safe, we skip filtering here to avoid empty results if data is old.
                        } else {
                             // No Outer -> Force Sleeved (t)
                             candidates = candidates.filter(i => !i.category.includes('背心'));
                        }
                        
                        if (season === 'Summer') {
                            candidates = candidates.filter(i => !['毛衣/針織', '帽T/衛衣'].includes(i.category));
                        }
                    }

                    // 3. Suit Matching (Formal) - Only if not Master Style override
                    if (occasion === 'Formal' && slot === 'bottom' && newOutfit.outer && !masterStyle) {
                        const suitMatch = candidates.filter(b => b.color === newOutfit.outer.color);
                        if (suitMatch.length > 0) candidates = suitMatch;
                    }

                    if (candidates.length > 0) {
                        newOutfit[slot] = candidates[Math.floor(Math.random() * candidates.length)];
                    } else {
                        newOutfit[slot] = null;
                    }
                });

                setOutfit(newOutfit);
            };

            // Wrapper for main random button (No Master Style)
            const handleRandom = () => handleMasterRandom(null);

            const handleClearAll = () => setOutfit(DEFAULT_OUTFIT);
            const handleClearSlot = (slot) => setOutfit(prev => ({ ...prev, [slot]: null }));

            const currentFilteredWardrobe = wardrobe.filter(item => {
                const activeTab = INVENTORY_TABS.find(t => t.id === inventoryTab);
                return activeTab ? activeTab.slots.includes(item.slot) : true;
            });

            return (
                <div className="app-container">
                    <div className="px-6 pt-6 pb-2 bg-white border-b border-gray-100 flex justify-between items-center z-10 sticky top-0">
                        <h1 className="text-lg font-bold tracking-tighter flex items-center gap-2">
                            Minimalist 
                            <span className="bg-black text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm">V25.2</span>
                        </h1>
                    </div>

                    <FilterControls 
                        occasion={occasion} setOccasion={setOccasion}
                        season={season} setSeason={setSeason}
                    />

                    <div className="flex-1 overflow-y-auto no-scrollbar relative bg-gray-50">
                        <GhostEngine outfit={outfit} />
                        
                        <div className="px-6 mb-6">
                            <div className="grid grid-cols-4 gap-2 mb-6">
                                {['outer','inner','bottom','shoes'].map(slot => (
                                    <div key={slot} className="relative group">
                                        <div 
                                            onClick={() => setInventoryTab(slot)}
                                            className={`aspect-square rounded-xl border flex flex-col items-center justify-center cursor-pointer transition-all ${outfit[slot] ? 'bg-white border-black' : 'bg-gray-100 border-dashed border-gray-300'}`}
                                        >
                                            <span className="text-[9px] font-bold uppercase text-gray-400 mb-1">{SLOTS.find(s=>s.id===slot)?.label}</span>
                                            {outfit[slot] ? (
                                                <div 
                                                    className="w-3 h-3 rounded-full border border-gray-200" 
                                                    style={{ backgroundColor: ALL_COLORS.find(c => c.id === outfit[slot].color)?.hex || '#000000' }}
                                                ></div>
                                            ) : (
                                                <span className="text-xs text-gray-300 font-bold">+</span>
                                            )}
                                        </div>
                                        {outfit[slot] && (
                                            <button 
                                                onClick={(e) => { e.stopPropagation(); handleClearSlot(slot); }}
                                                className="absolute -top-2 -right-2 bg-white border border-gray-200 text-gray-400 rounded-full p-1 shadow hover:text-red-500 z-20"
                                            >
                                                <Icon name="x" className="w-3 h-3" />
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>

                            <div className="flex gap-3 mb-4">
                                <button onClick={handleClearAll} className="flex-1 py-3 bg-white border border-gray-200 text-gray-500 text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-50 flex items-center justify-center gap-2 active:scale-95 transition-transform">
                                    <Icon name="trash" className="w-4 h-4" /> 全部脫下
                                </button>
                                <button onClick={handleRandom} className="flex-[2] py-3 bg-black text-white text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-900 shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95">
                                    <Icon name="dice" className="w-4 h-4" /> 隨機補位
                                </button>
                            </div>

                            {/* V25.2: Master Style Buttons */}
                            <div className="flex gap-2">
                                <button onClick={() => handleMasterRandom('MINIMAL')} className="master-btn">
                                    <div className="flex gap-1"><div className="w-2 h-2 rounded-full bg-black"></div><div className="w-2 h-2 rounded-full bg-gray-300"></div></div>
                                    精煉極簡
                                </button>
                                <button onClick={() => handleMasterRandom('EARTH')} className="master-btn">
                                    <div className="flex gap-1"><div className="w-2 h-2 rounded-full bg-[#8B4513]"></div><div className="w-2 h-2 rounded-full bg-[#F3E5AB]"></div></div>
                                    經典大地
                                </button>
                                <button onClick={() => handleMasterRandom('ITALIAN')} className="master-btn">
                                    <div className="flex gap-1"><div className="w-2 h-2 rounded-full bg-[#1E3A8A]"></div><div className="w-2 h-2 rounded-full bg-[#4B3621]"></div></div>
                                    雅痞藍棕
                                </button>
                            </div>
                        </div>

                        {/* Inventory Grid */}
                        <div className="bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.05)] min-h-[400px] p-6 pb-24">
                            <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                                {INVENTORY_TABS.map(tab => (
                                    <button 
                                        key={tab.id} 
                                        onClick={() => setInventoryTab(tab.id)}
                                        className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors ${inventoryTab === tab.id ? 'bg-black text-white' : 'bg-white text-gray-400 border border-gray-100'}`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                {currentFilteredWardrobe.map(item => (
                                    <div key={item.id} onClick={() => setOutfit(prev => ({...prev, [item.slot]: item}))} className="dense-card cursor-pointer group relative">
                                        <img src={item.displayUrl} alt={item.category} />
                                        
                                        <div 
                                            className="absolute bottom-2 right-2 w-2 h-2 rounded-full border border-gray-100 shadow-sm"
                                            style={{ background: ALL_COLORS.find(c => c.id === item.color)?.hex || '#000' }}
                                        ></div>
                                        
                                        <button onClick={(e) => { e.stopPropagation(); handleDeleteItem(item.id); }} className="absolute top-2 right-2 p-1 bg-white/80 rounded-full text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icon name="trash" className="w-3 h-3" /></button>
                                        
                                        {outfit[item.slot]?.id === item.id && <div className="absolute inset-0 border-2 border-black rounded-xl pointer-events-none"></div>}
                                    </div>
                                ))}
                            </div>
                            
                            {currentFilteredWardrobe.length === 0 && (
                                <div className="text-center py-12 text-gray-300 text-xs">
                                    尚無單品
                                </div>
                            )}
                        </div>
                    </div>

                    <button onClick={() => setShowAddModal(true)} className="absolute bottom-6 right-6 w-14 h-14 bg-black text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-105 transition-transform z-30 cursor-pointer border border-gray-800"><Icon name="plus" className="w-6 h-6" /></button>

                    <AddItemModal isOpen={showAddModal} onClose={() => setShowAddModal(false)} onAdd={handleAddItem} />
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>