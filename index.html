<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minimalist V28.2 - Layout & URL Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [V28.2 Visual Fix] */
        :root { --bg: #f9fafb; --card: #ffffff; --text: #111; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #000; /* å¤–éƒ¨èƒŒæ™¯å…¨é»‘ï¼Œå¼·èª¿æ‰‹æ©Ÿæ„Ÿ */
            color: var(--text); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; /* å‚ç›´ç½®ä¸­ */
            height: 100vh; 
            overflow: hidden; 
        }
        
        /* æ‰‹æ©Ÿæ¡†æ¶é™åˆ¶ */
        .app-frame { 
            width: 100%; 
            max-width: 414px; /* iPhone Max å¯¬åº¦ */
            height: 100%; 
            max-height: 100vh;
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            box-shadow: 0 0 40px rgba(255,255,255,0.1); /* å¾®å…‰æ•ˆæœ */
            overflow: hidden;
        }

        .scroll-area { 
            flex: 1; 
            overflow-y: auto; 
            scrollbar-width: none; 
            padding-bottom: 90px; /* é¿é–‹åº•éƒ¨å°èˆª */
        }
        .scroll-area::-webkit-scrollbar { display: none; }
        
        /* Ghost Engine */
        .ghost-stage { 
            position: relative; 
            width: 100%; 
            aspect-ratio: 4/5; 
            background: #fff; 
            overflow: hidden; 
            border-bottom: 1px solid #eee; 
        }
        .ghost-layer { 
            position: absolute; 
            inset: 0; 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            object-position: bottom center; 
            transition: opacity 0.3s; 
            pointer-events: none; 
        }
        
        /* Shoe Scaling Logic */
        .is-shoe { 
            transform: scale(3.5) translateZ(0); 
            transform-origin: bottom center; 
        }
        
        /* UI Components */
        .tab-pill { 
            padding: 6px 14px; 
            border-radius: 99px; 
            font-size: 11px; 
            font-weight: 600; 
            white-space: nowrap; 
            border: 1px solid transparent; 
            cursor: pointer; 
            transition: 0.2s; 
            background: #fff;
            color: #666;
            border-color: #eee;
        }
        .tab-pill.active { background: #000; color: #fff; border-color: #000; }

        .item-card { 
            aspect-ratio: 3/4; 
            background: #fff; 
            border-radius: 12px; 
            border: 1px solid #eee; 
            position: relative; 
            overflow: hidden; 
            cursor: pointer; 
            transition: 0.1s; 
        }
        .item-card:active { transform: scale(0.96); border-color: #000; }
        .item-card img { padding: 8px; width: 100%; height: 100%; object-fit: contain; }
        
        /* Bottom Navigation */
        .bottom-nav { 
            position: absolute; 
            bottom: 0; 
            left: 0;
            width: 100%; 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(10px); 
            border-top: 1px solid #eee; 
            display: flex; 
            justify-content: space-around; /* å¹³å‡åˆ†é… */
            padding: 12px 0 24px; 
            z-index: 50; 
        }
        .nav-icon { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            color: #999; 
            font-size: 10px; 
            font-weight: 600; 
            cursor: pointer; 
            width: 60px; /* å¢åŠ é»æ“Šå€åŸŸ */
        }
        .nav-icon.active { color: #000; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .anim-entry { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // =================================================================
        // âš ï¸ 1. è¨­å®šå€åŸŸ âš ï¸
        // =================================================================
        
        // [GITHUB PATH FIX] å»æ‰äº† refs/heads/
        // è«‹ç¢ºèªæ‚¨çš„è·¯å¾‘æ˜¯å¦ç‚º: githubusercontent.com/ä½¿ç”¨è€…/å€‰åº«å/åˆ†æ”¯å/è·¯å¾‘
        const GITHUB_RAW_URL = "https://raw.githubusercontent.com/oaoxd/my-wardrobe/main/images";

        // [FILE MANIFEST] è«‹åœ¨æ­¤è²¼ä¸Šæ‰€æœ‰æª”å
        const RAW_MANIFEST = [
            // è«‹è²¼ä¸Šæ‚¨çš„çœŸå¯¦æª”åæ¸…å–®ï¼Œä¾‹å¦‚ï¼š
            // "o_suits_bk_01.png",
            // "i_shirts_wh_01.png",
        ];

        // =================================================================

        // --- 2. æ ¸å¿ƒé‚è¼¯ (Logic V28.2) ---
        
        const UI_LABELS = {
            o: 'å¤–å¥—', i: 'å…§æ­', b: 'ä¸‹èº«', s: 'é‹æ¬¾',
            suits: 'è¥¿è£(å–®)', suitd: 'è¥¿è£(é›™)', coat: 'å¤§è¡£', leather: 'çš®è¡£', jacket: 'å¤¾å…‹',
            shirt: 'è¥¯è¡«', tshirt: 'Tæ¤', polo: 'Polo', knit: 'é‡ç¹”',
            jeans: 'ç‰›ä»”', chino: 'å¡å…¶', shorts: 'çŸ­è¤²', sport: 'é‹å‹•',
            dress: 'çš®é‹', loafer: 'æ¨‚ç¦', sneaker: 'çƒé‹', boots: 'é´å­',
            bk: 'é»‘', wh: 'ç™½', gy: 'ç°', nv: 'æ·±è—', be: 'ç±³', br: 'æ£•', dn: 'ä¸¹å¯§', gn: 'è»ç¶ '
        };

        const COLOR_HEX = {
            bk: '#1a1a1a', wh: '#f3f4f6', gy: '#6b7280', nv: '#1e3a8a',
            be: '#d2b48c', br: '#5d4037', dn: '#3b82f6', gn: '#355e3b'
        };

        const parseFilename = (rawName) => {
            // [Fix] Windows å‰¯æª”åå®¹éŒ¯ + ç©ºç™½è™•ç†
            const cleanName = rawName.trim().replace(/\.png$/i, '');
            const parts = cleanName.split('_'); // [slot, cat, color, id]

            if (parts.length < 4) return null;

            const [slotCode, catRaw, colorCode] = parts;
            let finalCat = catRaw;
            let sleeveType = 'standard';

            // [Logic] å…§æ­ (i) å»å­—å°¾ï¼›å…¶ä»–éƒ¨ä½ (o/b/s) ä¿ç•™å®Œæ•´é¡åˆ¥å
            if (slotCode === 'i') {
                const suffix = catRaw.slice(-1); 
                if (suffix === 'n') {
                    sleeveType = 'sleeveless';
                    finalCat = catRaw.slice(0, -1); 
                } else if (suffix === 's') {
                    sleeveType = 'sleeved';
                    finalCat = catRaw.slice(0, -1);
                }
            }
            
            return {
                uuid: cleanName, 
                filename: rawName.trim(), // ä¿ç•™å®Œæ•´æª”åç”¨æ–¼ URL
                url: `${GITHUB_RAW_URL}/${rawName.trim()}`, 
                slot: slotCode,
                category: finalCat,
                color: colorCode,
                sleeve: sleeveType,
                isShoe: slotCode === 's',
                label: UI_LABELS[finalCat] || finalCat,
                colorLabel: UI_LABELS[colorCode] || colorCode
            };
        };

        const SYSTEM_STOCK = RAW_MANIFEST.map(parseFilename).filter(Boolean);

        // --- 3. Database (IndexedDB) ---
        const DB_KEY = 'MinWardrobe_V28_2';
        const dbAPI = {
            open: () => new Promise(r => {
                const req = indexedDB.open(DB_KEY, 1);
                req.onupgradeneeded = e => e.target.result.createObjectStore('items', { keyPath: 'uuid' });
                req.onsuccess = e => r(e.target.result);
            }),
            getAll: async () => {
                const db = await dbAPI.open();
                return new Promise(r => {
                    const tx = db.transaction('items', 'readonly');
                    const req = tx.objectStore('items').getAll();
                    req.onsuccess = () => r(req.result);
                });
            },
            add: async (item) => {
                const db = await dbAPI.open();
                const tx = db.transaction('items', 'readwrite');
                tx.objectStore('items').put(item); 
                return new Promise(r => tx.oncomplete = r);
            },
            del: async (id) => {
                const db = await dbAPI.open();
                const tx = db.transaction('items', 'readwrite');
                tx.objectStore('items').delete(id);
                return new Promise(r => tx.oncomplete = r);
            }
        };

        // --- 4. Main App ---
        const Icon = ({ name }) => {
            const d = {
                hanger: "M12 2a5 5 0 0 1 4.9 6H7.1a5 5 0 0 1 4.9-6ZM3 11c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10H3V11Z",
                grid: "M3 3h7v7H3V3Zm11 0h7v7h-7V3Zm0 11h7v7h-7v-7ZM3 14h7v7H3v-7Z",
                plus: "M12 5v14M5 12h14",
                trash: "M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",
                dice: "M4 4h16v16H4V4Zm5 5h.01M15 9h.01M10 15h.01M15 15h.01"
            }[name];
            return <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d={d}/></svg>;
        };

        const SafeImg = ({ item, className }) => {
            const [err, setErr] = useState(false);
            if (err) return (
                <div className={`w-full h-full flex flex-col items-center justify-center bg-gray-50 text-gray-300 text-[10px] p-2 text-center border-dashed border border-gray-200 ${className}`}>
                    <span className="font-bold mb-1">{item.label}</span>
                    <span className="text-[8px] opacity-50 break-all">{item.filename}</span>
                </div>
            );
            return <img src={item.url} className={`${className} ${item.isShoe ? 'is-shoe' : ''}`} onError={() => setErr(true)} />;
        };

        const App = () => {
            const [wardrobe, setWardrobe] = useState([]);
            const [outfit, setOutfit] = useState({ o: null, i: null, b: null, s: null });
            const [tab, setTab] = useState('style');
            
            const [addSlot, setAddSlot] = useState('o');
            const [addCat, setAddCat] = useState('all');
            const [addColor, setAddColor] = useState('all');

            useEffect(() => { refreshDB(); }, []);

            const refreshDB = async () => {
                const items = await dbAPI.getAll();
                setWardrobe(items);
            };

            const toggleItem = async (sysItem) => {
                const exists = wardrobe.find(x => x.uuid === sysItem.uuid);
                if (exists) {
                    if(!confirm(`ç§»é™¤ ${sysItem.label}ï¼Ÿ`)) return;
                    await dbAPI.del(sysItem.uuid);
                } else {
                    await dbAPI.add(sysItem);
                }
                refreshDB();
            };

            const randomize = () => {
                const getR = (s) => {
                    const pool = wardrobe.filter(x => x.slot === s);
                    return pool.length ? pool[Math.floor(Math.random() * pool.length)] : null;
                };
                setOutfit({ o: getR('o'), i: getR('i'), b: getR('b'), s: getR('s') });
            };

            const filteredStock = useMemo(() => {
                return SYSTEM_STOCK.filter(x => {
                    if (x.slot !== addSlot) return false;
                    if (addCat !== 'all' && x.category !== addCat) return false;
                    if (addColor !== 'all' && x.color !== addColor) return false;
                    return true;
                });
            }, [addSlot, addCat, addColor, SYSTEM_STOCK]); // Add dependency

            // Dynamic Filters
            const availCats = useMemo(() => [...new Set(SYSTEM_STOCK.filter(x => x.slot === addSlot).map(x => x.category))], [addSlot]);
            const availColors = useMemo(() => {
                let pool = SYSTEM_STOCK.filter(x => x.slot === addSlot);
                if (addCat !== 'all') pool = pool.filter(x => x.category === addCat);
                return [...new Set(pool.map(x => x.color))];
            }, [addSlot, addCat]);

            return (
                <div className="app-frame">
                    <div className="scroll-area bg-gray-50">
                        {/* 1. STYLING */}
                        {tab === 'style' && (
                            <div className="anim-entry">
                                <div className="ghost-stage shadow-sm bg-white">
                                    {outfit.s && <div className="ghost-layer z-10"><SafeImg item={outfit.s} className="w-full h-full" /></div>}
                                    {outfit.b && <div className="ghost-layer z-20"><SafeImg item={outfit.b} className="w-full h-full" /></div>}
                                    {outfit.i && <div className="ghost-layer z-30"><SafeImg item={outfit.i} className="w-full h-full" /></div>}
                                    {outfit.o && <div className="ghost-layer z-40"><SafeImg item={outfit.o} className="w-full h-full" /></div>}
                                    
                                    {!outfit.s && !outfit.b && !outfit.i && !outfit.o && (
                                        <div className="absolute inset-0 flex flex-col items-center justify-center text-gray-300 gap-2">
                                            <span className="text-4xl opacity-20">ğŸ•´ï¸</span>
                                            <span className="text-xs tracking-widest">è«‹å…ˆè‡³ã€Œå€‰åº«ã€æ–°å¢å–®å“</span>
                                        </div>
                                    )}
                                </div>
                                <div className="p-4 grid grid-cols-4 gap-2">
                                    {['o','i','b','s'].map(s => (
                                        <div key={s} onClick={() => setOutfit(p => ({...p, [s]: null}))} className={`aspect-square rounded-xl border flex items-center justify-center overflow-hidden cursor-pointer relative ${outfit[s] ? 'bg-white border-black' : 'bg-gray-100 border-dashed'}`}>
                                            {outfit[s] ? (
                                                <>
                                                    <SafeImg item={outfit[s]} className="w-full h-full p-1" />
                                                    <div className="absolute top-1 right-1 w-1.5 h-1.5 bg-black rounded-full"></div>
                                                </>
                                            ) : <span className="text-xs text-gray-300 font-bold uppercase">{s}</span>}
                                        </div>
                                    ))}
                                </div>
                                <div className="px-4"><button onClick={randomize} className="w-full py-3 bg-black text-white rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform"><Icon name="dice"/> éš¨æ©Ÿæ­é…</button></div>
                            </div>
                        )}

                        {/* 2. CLOSET */}
                        {tab === 'closet' && (
                            <div className="p-4 anim-entry min-h-full bg-white">
                                <h2 className="text-xl font-bold mb-4">æˆ‘çš„è¡£æ«¥ ({wardrobe.length})</h2>
                                <div className="grid grid-cols-3 gap-3">
                                    {wardrobe.map(item => (
                                        <div key={item.uuid} onClick={() => { setOutfit(p => ({...p, [item.slot]: item})); setTab('style'); }} className="item-card bg-gray-50">
                                            <SafeImg item={item} />
                                            <button onClick={(e) => { e.stopPropagation(); toggleItem(item); }} className="absolute top-1 right-1 bg-white rounded-full p-1 text-red-500 shadow-sm"><Icon name="trash"/></button>
                                        </div>
                                    ))}
                                </div>
                                {wardrobe.length === 0 && <div className="text-center py-10 text-gray-400 text-xs">æš«ç„¡å–®å“</div>}
                            </div>
                        )}

                        {/* 3. WAREHOUSE (ADD) */}
                        {tab === 'add' && (
                            <div className="p-4 anim-entry min-h-full bg-white">
                                <h2 className="text-xl font-bold mb-4">æ–°å¢å–®å“</h2>
                                {/* Slot Tabs */}
                                <div className="flex gap-2 mb-4">
                                    {['o','i','b','s'].map(s => (
                                        <button key={s} onClick={() => { setAddSlot(s); setAddCat('all'); setAddColor('all'); }} className={`flex-1 py-2 text-xs font-bold rounded-lg border transition-colors ${addSlot === s ? 'bg-black text-white border-black' : 'bg-white text-gray-500 border-gray-200'}`}>{UI_LABELS[s]}</button>
                                    ))}
                                </div>
                                
                                {/* Category Tabs */}
                                <div className="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                                    <button onClick={() => setAddCat('all')} className={`tab-pill ${addCat === 'all' ? 'active' : 'inactive'}`}>å…¨éƒ¨</button>
                                    {availCats.map(c => (
                                        <button key={c} onClick={() => setAddCat(c)} className={`tab-pill ${addCat === c ? 'active' : 'inactive'}`}>{UI_LABELS[c] || c}</button>
                                    ))}
                                </div>

                                {/* Color Dots */}
                                <div className="flex gap-3 mb-6 items-center overflow-x-auto no-scrollbar py-1">
                                    <button onClick={() => setAddColor('all')} className={`text-xs font-bold px-2 ${addColor==='all' ? 'text-black' : 'text-gray-400'}`}>All</button>
                                    {availColors.map(c => (
                                        <div key={c} onClick={() => setAddColor(c)} className={`w-6 h-6 rounded-full border border-gray-200 cursor-pointer shadow-sm flex-shrink-0 transition-transform ${addColor === c ? 'ring-2 ring-black ring-offset-2 scale-110' : ''}`} style={{background: COLOR_HEX[c] || '#ddd'}}></div>
                                    ))}
                                </div>

                                {/* List */}
                                <div className="grid grid-cols-3 gap-3 pb-20">
                                    {filteredStock.map(item => {
                                        const inCloset = wardrobe.some(x => x.uuid === item.uuid);
                                        return (
                                            <div key={item.uuid} onClick={() => toggleItem(item)} className={`item-card ${inCloset ? 'ring-2 ring-black ring-offset-1 border-transparent' : 'hover:border-black'}`}>
                                                <SafeImg item={item} />
                                                {inCloset && <div className="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full shadow-sm z-10"></div>}
                                                <div className="absolute bottom-0 left-0 right-0 bg-white/95 text-[9px] text-center py-1.5 px-1 truncate border-t border-gray-100">
                                                    {item.label} 
                                                    {item.sleeve === 'sleeveless' && <span className="text-red-500 ml-0.5">ç„¡è¢–</span>}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {filteredStock.length === 0 && <div className="col-span-3 text-center text-gray-400 text-xs py-10">ç„¡ç¬¦åˆæ¢ä»¶å–®å“</div>}
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="bottom-nav">
                        <div onClick={() => setTab('style')} className={`nav-icon ${tab === 'style' ? 'active' : ''}`}><Icon name="hanger" />æ­é…</div>
                        <div onClick={() => setTab('closet')} className={`nav-icon ${tab === 'closet' ? 'active' : ''}`}><Icon name="grid" />è¡£æ«¥</div>
                        <div onClick={() => setTab('add')} className={`nav-icon ${tab === 'add' ? 'active' : ''}`}><Icon name="plus" />å€‰åº«</div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>