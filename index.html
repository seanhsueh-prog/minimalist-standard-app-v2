<!-- minimalist-wardrobe-core_v27_20.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Minimalist V27.20 - Master Stable</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; background-color: #111; margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; }
    .app-container { width: 100%; max-width: 480px; height: 100vh; background-color: #ffffff; position: relative; box-shadow: 0 0 60px rgba(0,0,0,0.6); display: flex; flex-direction: column; overflow: hidden; }
    .content-area { flex: 1; overflow-y: auto; padding-bottom: 80px; -ms-overflow-style: none; scrollbar-width: none; }
    .content-area::-webkit-scrollbar { display: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fade-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    /* Ghost Canvas - V26.5 Pure Logic */
    .ghost-canvas-container { position: relative; width: 100%; aspect-ratio: 4 / 5; background-color: #f9fafb; overflow: hidden; border-bottom: 1px solid #f0f0f0; }
    .ghost-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; object-position: bottom center; pointer-events: none; transition: opacity 0.3s ease-in-out; will-change: transform, opacity; }
    /* Controls */
    .floating-controls { position: absolute; right: 12px; top: 50%; transform: translateY(-40%); display: flex; flex-direction: column; gap: 12px; z-index: 50; }
    .control-group { display: flex; flex-direction: column; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px); border-radius: 99px; padding: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.5); }
    .mini-btn { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; color: #9ca3af; transition: all 0.2s; cursor: pointer; margin-bottom: 2px; }
    .mini-btn.active { background-color: #000; color: #fff; transform: scale(1.05); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    /* Warehouse & Grid */
    .warehouse-item { aspect-ratio: 3/4; border: 1px solid #eee; border-radius: 12px; cursor: pointer; position: relative; background: #fff; overflow: hidden; display: flex; align-items: center; justify-content: center; }
    .cat-pill { padding: 6px 12px; border-radius: 999px; font-size: 11px; font-weight: 600; white-space: nowrap; border: 1px solid #eee; cursor: pointer; margin-right: 4px; }
    .cat-pill.active { background-color: #000; color: #fff; border-color: #000; }
    .cat-pill.inactive { background-color: #fff; color: #666; }
    .bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 12px 0 24px 0; z-index: 50; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; font-weight: 600; color: #9ca3af; cursor: pointer; flex: 1; }
    .nav-item.active { color: #000; }
    .dense-card { aspect-ratio: 1/1; position: relative; background: #fff; border-radius: 0.75rem; border: 1px solid #f3f4f6; overflow: hidden; display: flex; align-items: center; justify-content: center; padding: 2px; }
</style>
</head>
<body>
<div id="root" class="w-full flex justify-center"></div>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    const RAW_MANIFEST = [
        "o_suits_bk_01.png", "o_suits_br_01.png", "o_suits_gy_01.png", "o_suits_nv_01.png",
        "o_suitd_bk_01.png", "o_suitd_br_01.png", "o_suitd_gy_01.png", "o_suitd_nv_01.png",
        "o_leather_bk_01.png", "o_leather_bk_02.png", "o_leather_bk_03.png", "o_leather_bk_04.png", 
        "o_leather_br_01.png", "o_leather_br_02.png", "o_leather_br_03.png",
        "o_jacket_bk_01.png", "o_jacket_bk_03.png", "o_jacket_bk_04.png",
        "o_jacket_br_01.png", "o_jacket_br_02.png", "o_jacket_br_03.png",
        "o_jacket_gn_01.png", "o_jacket_gn_02.png", "o_jacket_gn_03.png",
        "o_jacket_gy_01.png", "o_jacket_gy_02.png", "o_jacket_gy_03.png", "o_jacket_gy_04.png",
        "o_jacket_nv_01.png", "o_jacket_nv_02.png", "o_jacket_nv_03.png",
        "o_down_gy_01.png", "o_down_nv_01.png", "o_down_wh_01.png",
        "i_knits_be_01.png", "i_knits_bk_01.png", "i_knits_br_01.png", "i_knits_gy_01.png", "i_knits_rd_01.png",
        "i_knitn_be_01.png", "i_knitn_bk_01.png", "i_knitn_br_01.png", "i_knitn_gy_01.png", "i_knitn_rd_01.png",
        "i_shirts_bk_01.png", "i_shirts_nv_01.png", "i_shirts_wh_01.png",
        "i_shirtn_bk_01.png", "i_shirtn_nv_01.png", "i_shirtn_wh_01.png",
        "i_sweats_bk_01.png", "i_sweats_gn_01.png", "i_sweats_gy_01.png", "i_sweats_nv_01.png", "i_sweats_wh_01.png",
        "i_tshirts_bk_01.png", "i_tshirts_gy_01.png", "i_tshirts_wh_01.png",
        "i_tshirtn_bk_01.png", "i_tshirtn_gy_01.png", "i_tshirtn_nv_01.png", "i_tshirtn_wh_01.png",
        "b_cargo_be_01.png", "b_cargo_bk_01.png", "b_cargo_gn_01.png", "b_chino_be_01.png",
        "b_jeans_bk_01.png", "b_jeans_nv_01.png",
        "b_sport_bk_01.png", "b_sport_gy_01.png", "b_sport_nv_01.png", "b_sport_wh_01.png",
        "b_suit_be_02.png", "b_suit_bk_01.png", "b_suit_bk_02.png", "b_suit_br_01.png", "b_suit_br_02.png", 
        "b_suit_gn_01.png", "b_suit_gn_02.png", "b_suit_gy_01.png", "b_suit_gy_02.png", "b_suit_nv_01.png",
        "s_dress_bk_01.png", "s_dress_br_01.png",
        "s_leasnk_bk_01.png", "s_leasnk_wh_01.png",
        "s_loafer_bk_01.png", "s_loafer_br_01.png", "s_loafer_nv_01.png",
        "s_sport_bk_01.png", "s_sport_gy_01.png", "s_sport_wh_01.png"
    ];

    const DB_CONFIG = { name: 'MinimalistVault_V27_Master', version: 1, store: 'inventory' };
    const SLOT_MAP = { 'o': 'outer', 'i': 'inner', 'b': 'bottom', 's': 'shoes' };
    const CAT_DISPLAY = { 'suits': '單排西裝', 'suitd': '雙排西裝', 'leather': '皮衣', 'jacket': '夾克', 'down': '羽絨', 'knits': '針織', 'knitn': '針織背心', 'shirts': '襯衫', 'shirtn': '襯衫背心', 'sweats': '衛衣', 'tshirts': 'T-shirt', 'tshirtn': 'T-shirt背心', 'polo': 'Polo衫', 'cargo': '工裝褲', 'chino': '卡其褲', 'jeans': '牛仔褲', 'sport': '運動褲', 'suit': '西裝褲', 'dress': '皮鞋', 'leasnk': '皮革休閒', 'loafer': '樂福鞋', 'boots': '靴子' };
    const COLOR_MAP = { 'bk': '#1A1A1A', 'wh': '#FFFFFF', 'gy': '#6B7280', 'nv': '#1E3A8A', 'be': '#C3B091', 'br': '#5D4037', 'gn': '#355E3B', 'rd': '#7F1D1D', 'dn': '#3B82F6' };
    const STYLE_RULES = { 'suits': ['Formal', 'Smart'], 'suitd': ['Formal', 'Smart'], 'leather': ['Smart', 'Casual'], 'jacket': ['Smart', 'Casual'], 'down': ['Casual'], 'knits': ['Smart', 'Casual'], 'knitn': ['Smart', 'Casual'], 'shirts': ['Formal', 'Smart'], 'shirtn': ['Formal', 'Smart'], 'sweats': ['Casual'], 'tshirts': ['Smart', 'Casual'], 'tshirtn': ['Smart', 'Casual'], 'suit': ['Formal', 'Smart'], 'jeans': ['Smart', 'Casual'], 'chino': ['Smart', 'Casual'], 'cargo': ['Casual'], 'sport': ['Casual'], 'dress': ['Formal', 'Smart'], 'loafer': ['Formal', 'Smart'], 'leasnk': ['Smart', 'Casual'] };
    const BOTTOM_SORT_ORDER = ['suit', 'jeans', 'chino', 'shorts', 'sport', 'cargo'];
    const INNER_SORT_ORDER = ['shirts', 'shirtn', 'tshirts', 'tshirtn', 'polo', 'knits', 'knitn', 'sweats', 'hoodie'];
    const SHOES_SORT_ORDER = ['dress', 'loafer', 'leasnk', 'sport', 'boots'];
    const COLOR_SORT_ORDER = ['bk', 'wh', 'gy', 'nv', 'be', 'br', 'gn', 'rd', 'dn'];
    const SLOTS = [{ id: 'coat', label: '大衣' }, { id: 'outer', label: '外套' }, { id: 'inner', label: '內搭' }, { id: 'bottom', label: '褲裝' }, { id: 'shoes', label: '鞋款' }];
    const CLOSET_TABS = [{ id: 'outer', label: '外套', slots: ['outer', 'coat'] }, { id: 'inner', label: '內搭', slots: ['inner'] }, { id: 'bottom', label: '褲裝', slots: ['bottom'] }, { id: 'shoes', label: '鞋款', slots: ['shoes'] }];

    const parseManifest = () => RAW_MANIFEST.map(f => {
        const p = f.replace('.png', '').split('_'); 
        if (p.length < 4) return null;
        let sleeve = 'standard';
        if (p[1].endsWith('n') && p[0] === 'i') sleeve = 'sleeveless';
        else if (p[1].endsWith('s') && p[0] === 'i') sleeve = 'sleeved';
        else if (p[1] === 'sweats') sleeve = 'sleeved';
        let lbl = CAT_DISPLAY[p[1]] || p[1];
        if (p[0] === 's' && p[1] === 'sport') lbl = '運動鞋';
        return { src: f, displayUrl: `./${f}`, slot: SLOT_MAP[p[0]]||'unknown', catCode: p[1], color: p[2], sleeve, label: lbl, hex: COLOR_MAP[p[2]]||'#000' };
    }).filter(Boolean);
    const MANIFEST_ITEMS = parseManifest();

    const dbHelper = {
        open: () => new Promise((res, rej) => {
            const req = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version);
            req.onupgradeneeded = (e) => { if (!e.target.result.objectStoreNames.contains(DB_CONFIG.store)) e.target.result.createObjectStore(DB_CONFIG.store, { keyPath: 'id', autoIncrement: true }); };
            req.onsuccess = () => res(req.result); req.onerror = () => rej(req.error);
        }),
        addItem: async (item) => { const db = await dbHelper.open(); return new Promise((res, rej) => { const tx = db.transaction(DB_CONFIG.store, 'readwrite'); const req = tx.objectStore(DB_CONFIG.store).add(item); req.onsuccess = () => res({ ...item, id: req.result }); req.onerror = () => rej(req.error); }); },
        getAll: async () => { const db = await dbHelper.open(); return new Promise((res, rej) => { const tx = db.transaction(DB_CONFIG.store, 'readonly'); const req = tx.objectStore(DB_CONFIG.store).getAll(); req.onsuccess = () => res(req.result); req.onerror = () => rej(req.error); }); },
        delete: async (id) => { const db = await dbHelper.open(); return new Promise((res, rej) => { const tx = db.transaction(DB_CONFIG.store, 'readwrite'); const req = tx.objectStore(DB_CONFIG.store).delete(id); req.onsuccess = () => res(); req.onerror = () => rej(req.error); }); }
    };

    const Icon = ({ name, className }) => {
        const i = {
            hanger: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a5 5 0 0 1 4.9 6H7.1a5 5 0 0 1 4.9-6Z"/><path d="M21 21H3V11c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10Z"/></svg>,
            grid: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
            plus: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14"/></svg>,
            trash: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            dice: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/><circle cx="16" cy="16" r="1.5" fill="currentColor"/><circle cx="8" cy="16" r="1.5" fill="currentColor"/><circle cx="16" cy="8" r="1.5" fill="currentColor"/></svg>,
            x: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };
        return i[name] ? React.cloneElement(i[name], { className }) : null;
    };

    const GhostEngine = ({ outfit, occasion, setOccasion, season, setSeason, triggerRandom }) => {
        const { coat, outer, inner, bottom, shoes } = outfit;
        return (
            <div className="w-full mb-0 flex justify-center items-center animate-fade-in bg-white relative">
                <div className="ghost-canvas-container mx-auto relative">
                    {/* V26.5 Pure Rendering: No transforms on canvas layers */}
                    {shoes && <img src={shoes.displayUrl} className="ghost-layer z-10" alt="Shoes" />}
                    {bottom && <img src={bottom.displayUrl} className="ghost-layer z-20" alt="Bottom" />}
                    {inner && <img src={inner.displayUrl} className="ghost-layer z-30" alt="Inner" />}
                    {(coat || outer) && <img src={coat?.displayUrl || outer?.displayUrl} className="ghost-layer z-40" alt="Outer" />}
                    
                    {!shoes && !bottom && !inner && !outer && !coat && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center z-20">
                            <p className="text-gray-300 text-xs tracking-widest">WARDROBE EMPTY</p>
                        </div>
                    )}
                </div>
                <div className="floating-controls">
                    <div className="control-group mb-3">
                        {[{id:'Winter',l:'冬'}, {id:'Summer',l:'夏'}].map(s => (
                            <button key={s.id} className={`mini-btn ${season === s.id ? 'active' : ''}`} onClick={() => { setSeason(s.id); triggerRandom(occasion, s.id); }}>{s.l}</button>
                        ))}
                    </div>
                    <div className="control-group">
                        {[{id:'Formal',l:'正式'}, {id:'Smart',l:'大人'}, {id:'Casual',l:'休閒'}].map(o => (
                            <button key={o.id} className={`mini-btn ${occasion === o.id ? 'active' : ''}`} onClick={() => { setOccasion(o.id); triggerRandom(o.id, season); }}>{o.l.slice(0,1)}</button>
                        ))}
                    </div>
                </div>
            </div>
        );
    };

    const App = () => {
        const [wardrobe, setWardrobe] = useState([]);
        const [outfit, setOutfit] = useState({ coat: null, outer: null, inner: null, bottom: null, shoes: null });
        const [activeTab, setActiveTab] = useState('styling');
        const [closetTab, setClosetTab] = useState('outer');
        const [occasion, setOccasion] = useState('Smart');
        const [season, setSeason] = useState('Winter');
        const [whSlot, setWhSlot] = useState('outer');
        const [whSleeve, setWhSleeve] = useState('sleeved'); 
        const [whCatFilter, setWhCatFilter] = useState(''); 
        const [whColorFilter, setWhColorFilter] = useState(''); 

        const loadData = async () => { try { const items = await dbHelper.getAll(); setWardrobe(items); } catch (e) { console.error(e); } };
        useEffect(() => { loadData(); }, []);

        const addToWardrobe = async (manifestItem) => {
            const styles = STYLE_RULES[manifestItem.catCode] || ['Casual'];
            const newItem = { ...manifestItem, style: styles, createdAt: Date.now() }; delete newItem.id; 
            try { await dbHelper.addItem(newItem); await loadData(); alert("已加入衣櫥"); } catch (e) { alert("加入失敗"); }
        };

        const removeFromWardrobe = async (id) => {
            if(!confirm("確定移除?")) return;
            await dbHelper.delete(id); loadData();
            setOutfit(prev => { const next = { ...prev }; Object.keys(next).forEach(k => { if(next[k]?.id === id) next[k] = null; }); return next; });
        };

        const getRandomItem = (slot, occ, sea, currentOutfit) => {
            let c = wardrobe.filter(item => item.slot === slot || (slot === 'outer' && item.slot === 'coat'));
            c = c.filter(item => item.style.includes(occ));
            if (slot === 'inner') {
                const hasOuter = currentOutfit.outer || currentOutfit.coat;
                c = c.filter(i => hasOuter ? i.sleeve === 'sleeveless' : i.sleeve === 'sleeved');
                if (sea === 'Summer') c = c.filter(i => !['knits','sweats','knitn'].includes(i.catCode));
            }
            if (c.length === 0) return null;
            return c[Math.floor(Math.random() * c.length)];
        };

        const handleRandom = (targetOcc, targetSea) => {
            const no = { ...outfit };
            if (targetSea === 'Summer' && targetOcc !== 'Formal') { no.outer = null; no.coat = null; } 
            else { no.outer = getRandomItem('outer', targetOcc, targetSea, no); }
            if (targetOcc === 'Formal' && no.outer && (no.outer.catCode === 'suits' || no.outer.catCode === 'suitd')) {
                 const sp = wardrobe.find(b => b.slot === 'bottom' && b.catCode === 'suit' && b.color === no.outer.color);
                 no.bottom = sp || getRandomItem('bottom', targetOcc, targetSea, no);
            } else { no.bottom = getRandomItem('bottom', targetOcc, targetSea, no); }
            no.inner = getRandomItem('inner', targetOcc, targetSea, no);
            no.shoes = getRandomItem('shoes', targetOcc, targetSea, no);
            setOutfit(no);
        };

        const getFilteredManifest = () => {
            let base = MANIFEST_ITEMS.filter(i => i.slot === whSlot);
            if (whSlot === 'inner') base = base.filter(i => i.sleeve === whSleeve);
            return base;
        };

        const getAvailableCats = () => {
            const base = getFilteredManifest();
            const codes = [...new Set(base.map(i => i.catCode))];
            if (whSlot === 'bottom') codes.sort((a,b) => (BOTTOM_SORT_ORDER.indexOf(a) - BOTTOM_SORT_ORDER.indexOf(b)));
            else if (whSlot === 'inner') codes.sort((a,b) => (INNER_SORT_ORDER.indexOf(a) - INNER_SORT_ORDER.indexOf(b)));
            else if (whSlot === 'shoes') codes.sort((a,b) => (SHOES_SORT_ORDER.indexOf(a) - SHOES_SORT_ORDER.indexOf(b)));
            return codes.map(c => { let l = CAT_DISPLAY[c] || c; if(whSlot==='shoes'&&c==='sport')l='運動鞋'; if(whSlot==='bottom'&&c==='sport')l='運動褲'; return { code: c, label: l }; });
        };
        const getAvailableColors = () => {
            if (!whCatFilter) return [];
            let base = getFilteredManifest().filter(i => i.catCode === whCatFilter);
            const codes = [...new Set(base.map(i => i.color))];
            codes.sort((a,b) => (COLOR_SORT_ORDER.indexOf(a) - COLOR_SORT_ORDER.indexOf(b)));
            return codes;
        };

        useEffect(() => { const c = getAvailableCats(); setWhCatFilter(c.length > 0 ? c[0].code : ''); }, [whSlot, whSleeve]);
        useEffect(() => { const c = getAvailableColors(); setWhColorFilter(c.length > 0 ? c[0] : ''); }, [whCatFilter]);
        const getWarehouseItems = () => { if (!whCatFilter || !whColorFilter) return []; return getFilteredManifest().filter(i => i.catCode === whCatFilter && i.color === whColorFilter); };
        
        // Grid Zoom
        const getGridIconStyle = (slot) => {
            const c = { width: '100%', height: '100%', objectFit: 'contain', transition: 'transform 0.3s' };
            if (slot === 'shoes') return { ...c, transform: 'scale(3.5)', transformOrigin: '50% 100%' };
            if (slot === 'outer' || slot === 'inner') return { ...c, transform: 'scale(1.6)', transformOrigin: '50% 0%' };
            if (slot === 'bottom') return { ...c, transform: 'scale(1.05)', transformOrigin: '50% 50%' };
            return c;
        };

        return (
            <div className="app-container">
                <div className="px-6 pt-6 pb-2 bg-white border-b border-gray-100 flex justify-between items-center z-10 sticky top-0">
                    <h1 className="text-lg font-bold tracking-tighter flex items-center gap-2">Minimalist <span className="bg-black text-white text-[10px] px-2 py-0.5 rounded-full">V27.20</span></h1>
                </div>
                <div className="content-area bg-gray-50">
                    {activeTab === 'styling' && (
                        <div className="animate-fade-in">
                            <GhostEngine outfit={outfit} occasion={occasion} setOccasion={setOccasion} season={season} setSeason={setSeason} triggerRandom={handleRandom} />
                            <div className="px-6 mt-4">
                                <div className="grid grid-cols-4 gap-2 mb-4">
                                    {['outer','inner','bottom','shoes'].map(slot => (
                                        <div key={slot} className="relative group">
                                            <div className={`aspect-square rounded-xl border flex items-center justify-center overflow-hidden ${outfit[slot] ? 'bg-white border-black' : 'bg-gray-100 border-dashed border-gray-300'}`}>
                                                {outfit[slot] ? <img src={outfit[slot].displayUrl} style={getGridIconStyle(slot)} /> : <Icon name="plus" className="w-4 h-4 text-gray-300"/>}
                                            </div>
                                            {outfit[slot] && <button onClick={()=>setOutfit(p=>({...p,[slot]:null}))} className="absolute -top-1 -right-1 bg-white border rounded-full p-1 shadow z-20"><Icon name="x" className="w-3 h-3 text-gray-400"/></button>}
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={()=>setOutfit({coat:null,outer:null,inner:null,bottom:null,shoes:null})} className="flex-1 py-3 bg-white border border-gray-200 rounded-xl text-xs font-bold text-gray-500 flex items-center justify-center gap-2"><Icon name="trash" className="w-4 h-4"/>重置</button>
                                    <button onClick={()=>handleRandom(occasion, season)} className="flex-[2] py-3 bg-black text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-transform"><Icon name="dice" className="w-4 h-4"/>智慧搭配</button>
                                </div>
                            </div>
                        </div>
                    )}
                    {activeTab === 'closet' && (
                        <div className="p-6 animate-fade-in min-h-full bg-white">
                            <h2 className="text-xl font-bold mb-4">我的衣櫥 ({wardrobe.length})</h2>
                            <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                                {CLOSET_TABS.map(tab => ( <button key={tab.id} onClick={() => setClosetTab(tab.id)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors ${closetTab === tab.id ? 'bg-black text-white' : 'bg-gray-100 text-gray-400'}`}>{tab.label}</button> ))}
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                                {wardrobe.filter(item => CLOSET_TABS.find(t => t.id === closetTab)?.slots.includes(item.slot)).map(item => (
                                    <div key={item.id} className="dense-card group cursor-pointer" onClick={()=>{setOutfit(p=>({...p,[item.slot]:item}));setActiveTab('styling');}}>
                                        <img src={item.displayUrl} style={getGridIconStyle(item.slot)} />
                                        <button onClick={(e)=>{e.stopPropagation();removeFromWardrobe(item.id)}} className="absolute top-1 right-1 p-1 bg-white/80 rounded-full text-gray-300 hover:text-red-500"><Icon name="trash" className="w-3 h-3"/></button>
                                    </div>
                                ))}
                            </div>
                            {wardrobe.length === 0 && <div className="text-center py-12 text-gray-300 text-xs">衣櫥空空如也</div>}
                        </div>
                    )}
                    {activeTab === 'add' && (
                        <div className="p-6 animate-fade-in bg-white min-h-full">
                            <h2 className="text-xl font-bold mb-4">單品倉庫</h2>
                            <div className="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
                                {SLOTS.filter(s=>s.id!=='coat').map(s => ( <button key={s.id} onClick={()=>{setWhSlot(s.id);}} className={`px-4 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap border ${whSlot===s.id?'bg-black text-white border-black':'bg-white text-gray-500 border-gray-200'}`}>{s.label}</button> ))}
                            </div>
                            {whSlot === 'inner' && (
                                <div className="flex flex-col gap-2 mb-4">
                                    <div className="flex gap-2">
                                        <button onClick={()=>setWhSleeve('sleeved')} className={`flex-1 py-1.5 text-xs font-bold rounded border ${whSleeve==='sleeved'?'bg-gray-800 text-white':'bg-gray-50 text-gray-400'}`}>有袖 (Standard)</button>
                                        <button onClick={()=>setWhSleeve('sleeveless')} className={`flex-1 py-1.5 text-xs font-bold rounded border ${whSleeve==='sleeveless'?'bg-gray-800 text-white':'bg-gray-50 text-gray-400'}`}>無袖 (Layering)</button>
                                    </div>
                                    <p className="text-[11px] text-[#4b5563] leading-relaxed"><span className="font-bold block mb-1">必須同時準備有袖與無袖單品</span>無袖用於外套層次，有袖用於單穿展現。</p>
                                </div>
                            )}
                            <div className="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
                                {getAvailableCats().map(c => ( <button key={c.code} onClick={()=>setWhCatFilter(c.code)} className={`cat-pill ${whCatFilter===c.code?'active':'inactive'}`}>{c.label}</button> ))}
                            </div>
                            <div className="flex gap-3 mb-6 overflow-x-auto no-scrollbar py-1">
                                {getAvailableColors().map(c => ( <div key={c} onClick={()=>setWhColorFilter(c)} className={`w-8 h-8 rounded-full border cursor-pointer flex-shrink-0 ${whColorFilter===c?'ring-2 ring-offset-2 ring-black':''}`} style={{background:COLOR_MAP[c], borderColor: c==='wh' ? '#e5e7eb' : 'transparent'}}></div> ))}
                            </div>
                            <div className="grid grid-cols-2 gap-3 pb-20">
                                {getWarehouseItems().map((item, idx) => (
                                    <div key={idx} onClick={()=>addToWardrobe(item)} className="warehouse-item group">
                                        <img src={item.displayUrl} style={getGridIconStyle(whSlot)} />
                                        <div className="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity"><span className="bg-black text-white text-[10px] px-2 py-1 rounded-full font-bold">入庫</span></div>
                                    </div>
                                ))}
                                {getWarehouseItems().length === 0 && <p className="text-gray-400 text-xs col-span-2 text-center py-4">暫無此規格單品</p>}
                            </div>
                        </div>
                    )}
                </div>
                <div className="bottom-nav">
                    <div onClick={()=>setActiveTab('styling')} className={`nav-item ${activeTab==='styling'?'active':''}`}><Icon name="hanger" className="w-6 h-6"/><span>搭配</span></div>
                    <div onClick={()=>setActiveTab('closet')} className={`nav-item ${activeTab==='closet'?'active':''}`}><Icon name="grid" className="w-6 h-6"/><span>衣櫥</span></div>
                    <div onClick={()=>setActiveTab('add')} className={`nav-item ${activeTab==='add'?'active':''}`}><Icon name="plus" className="w-6 h-6"/><span>倉庫</span></div>
                </div>
            </div>
        );
    };
    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>